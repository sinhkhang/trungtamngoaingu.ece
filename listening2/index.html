<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS CDI Listening Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            line-height: 1.4;
            font-size: 16px;
            padding-bottom: 90px; /* nav-row height (80px) + some extra spacing */
        }

         /* Page watermark (image version) */
body::after {
    content: "";
    position: fixed;
    left: 50%;
    top: 70%;
    transform: translate(-50%, -50%);

    width: 600px;        /* kích thước watermark—tùy chỉnh */
    height: 600px;
    background-image: url('ECE-watermark.png');  /* file nằm cùng thư mục */
    background-size: contain;
    background-repeat: no-repeat;

    opacity: 0.08;        /* độ mờ */
    pointer-events: none;
    z-index: 0;
}



        .header {
    background-color: #0e3178 !important;
    padding: 12px 20px;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-between;  /* logo trái – text phải */
    align-items: center;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    height: 60px;
}

/* Logo bên trái */
.ece-logo {
    height: 38px;       /* chỉnh cao logo */
    display: block;
}

/* Nút "TRUNG TÂM NGOẠI NGỮ ECE" bên phải */
.telegram-link {
    color: white;
    font-weight: bold;
    text-decoration: none;
}

        .header {
            background-color: #ffffff;
            padding: 12px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            height: 60px;
        }

        .ielts-logo {
            display: none;
        }

        .test-info {
            display: flex;
            align-items: center;
            gap: 30px;
            font-size: 14px;
            color: #333;
        }

        .audio-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .audio-icon {
            width: 16px;
            height: 16px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg>') no-repeat center;
        }

        .header-icons {
    display: none;      /* Ẩn hẳn khối icon bên phải */
}

        .telegram-link {
            color: #3e3e3e;
            text-decoration: none;
            font-weight: 700;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border: 2px solid #3e3e3e;
            border-radius: 9999px;
            background-color: #ffffff;
            line-height: 1;
        }

        .telegram-link:hover {
            background-color: #f6f6f6;
        }

        .telegram-link::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            background-color: currentColor;
            -webkit-mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            mask-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.4c.75-.29 1.4.22 1.2.94l-2.67 12.61c-.22.95-1.13 1.18-1.78.73l-4.5-3.32l-2.23 2.15c-.47.44-1.29.21-1.48-.37z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
        }

        #volume-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 80px;
            height: 4px;
            background: #ddd;
            outline: none;
            border-radius: 2px;
            cursor: pointer;
        }

        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
        }

        #volume-slider::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #333;
            cursor: pointer;
            border: none;
        }

        .icon {
            width: 20px;
            height: 20px;
            cursor: pointer;
            opacity: 0.7;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon:hover {
            opacity: 1;
        }
        
        #play-pause-btn {
            background: none;
            border: none;
            padding: 0;
        }

        .main-container {
            margin-top: 60px;
            display: flex;
            background: #ffffff;
            padding-bottom: 100px; /* Space for bottom nav */
        }

        .main-container.results-mode {
            display: flex;
            flex-direction: row;
        }

        /* Left Panel */
        .left-panel {
            width: 100%;
            padding: 20px;
            transition: width 0.4s ease;
        }

        .main-container.results-mode .left-panel {
            width: 75%;
            overflow-y: auto;
            height: calc(100vh - 195px);
        }

        /* Right Panel */
        .right-panel {
            display: none;
            width: 50%;
            padding: 20px;
            position: relative;
            border-left: 1px solid #e0e0e0;
            overflow-y: auto;
            height: calc(100vh - 195px);
        }

        #transcription-container h2 {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        #transcription-text {
            white-space: pre-wrap; /* preserve line breaks from source */
            font-family: inherit;
            font-size: 15px;
            line-height: 1.7;
        }
        
        .transcription-instruction {
            display: block;
            margin: 1em 0;
            font-style: italic;
            color: #444;
        }

        .main-container.results-mode .right-panel {
            display: block;
            width: 25%;
            border-left: 1px solid #e0e0e0;
            border-top: none;
            height: calc(100vh - 195px);
            overflow-y: auto;
        }

        .help-button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 20px;
        }

        /* Inline correct answer hint (shown after checking) */
        .correct-inline {
            color: #28a745;
            font-weight: 700;
            margin-left: 10px;
            display: inline-block;
            vertical-align: middle;
            white-space: nowrap;
        }
        .correct-inline::before {
            content: "\2192  "; /* right arrow */
            font-weight: 700;
        }

        .help-button:hover {
            background: #357abd;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .people-section {
            margin-bottom: 30px;
        }

        .people-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ccc;
        }

        .people-table th {
            text-align: left;
            padding: 10px;
            font-weight: bold;
            border: 1px solid #ddd;
        }

        .people-table td {
            padding: 8px 10px;
            border: 1px solid #ddd;
        }

        #part-1 table td {
            line-height: 1.8;
        }
        /* Increase line height for tables in Part 4 */
        #part-4 table td {
            line-height: 2.0;
            padding-top: 10px;
            padding-bottom: 10px;
        }
        #part-4 table td div { margin: 8px 0; }
        /* Increase line height for Part 3 table (Questions 24-30) */
        #part-3 table td {
            line-height: 2.0;
            padding-top: 10px;
            padding-bottom: 10px;
            vertical-align: top;
        }
        /* Geosequestration table styling */
        .geo-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .geo-table th, .geo-table td { border: 1px solid #e5e7eb; padding: 14px; vertical-align: top; }
        .geo-table thead th { background: #f7f9fc; text-align: center; font-weight: 700; }
        .geo-table .arrow-row td { text-align: center; font-size: 20px; color: #6b7280; }

        .person-name {
            font-size: 16px;
        }

        .question-number {
            background: white;
            border: 1px solid #4a90e2;
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
            font-size: 14px;
            color: #4a90e2;
            min-width: 30px;
            text-align: center;
        }

        .assigned-responsibility {
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 14px;
            border: 1px solid #ddd;
        }

        .responsibilities-section {
            margin-bottom: 30px;
        }

        .responsibility-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .responsibility-item {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            text-align: center;
            transition: all 0.2s;
        }

        .responsibility-item:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .responsibility-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .questions-section {
            margin-bottom: 20px;
        }

        .question-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .instruction {
            margin-bottom: 20px;
            font-size: 16px;
            color: #666;
        }

        .centered-title {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        /* Map Styles */
        .map-container {
            position: relative;
            margin: 20px auto;
            width: 100%;
            max-width: 600px;
            /* display: block; */
            /* display: flex; */
        }
        .map-container img {
            width: 100%;
            display: block;
        }
        .map-drop-zone {
            position: absolute;
            width: 13%;
            height: 15%;
            border: 2px dashed #999;
            background-color: rgba(255, 255, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #555;
            border-radius: 4px;
            padding: 2px;
        }
        .map-drop-zone:hover {
            background-color: rgba(230, 244, 255, 0.7);
            border-color: #4a90e2;
        }
        .map-drop-zone .drag-item {
            font-size: 14px;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2px;
        }
        .map-options-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .map-options-list .drag-item {
            width: calc(25% - 10px);
            text-align: center;
        }

        /* Navigation Arrows */
        .nav-arrows {
            position: fixed;
            bottom: 100px;
            right: 20px;
            display: flex;
            gap: 5px;
            z-index: 101;
        }

        .nav-arrow {
            width: 50px;
            height: 50px;
            background: #333;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: bold;
        }

        .nav-arrow:hover {
            background: #555;
        }

        .nav-arrow:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Bottom Navigation - Exact Match */
        .nav-row {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
        
            padding: 0;
            display: flex;
            align-items: center;
            height: 80px;
            z-index: 100;

            /* Allow horizontal scrolling on smaller screens */
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        /* Prevent "Score/Band" button text overflow on small screens */
        .footer__deliverButton___3FM07 {
            max-width: 42%;
            white-space: normal;          /* allow wrapping */
            word-break: break-word;       /* break long text if needed */
            line-height: 1.2;
        }
        @media (max-width: 768px) {
            .footer__deliverButton___3FM07 {
                max-width: 55%;
                padding: 10px 12px;
                font-size: 14px;
            }
        }
        @media (max-width: 480px) {
            .footer__deliverButton___3FM07 {
                max-width: 65%;
                padding: 8px 10px;
                font-size: 13px;
            }
        }

        .footer__questionWrapper___1tZ46 {
            display: flex;
            align-items: center;
            margin-right: 20px;
            flex-shrink: 0;
        }


        .footer__questionNo___3WNct {
            background: none;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.2s;
        }

        .footer__questionNo___3WNct:hover {
            background-color: #f8f9fa;
        }

        .section-prefix {
            font-size: 16px;
        }

        .sectionNr {
            font-size: 16px;
            font-weight: bold;
        }

        .attemptedCount {
            font-size: 14px;
            color: #666;
            margin-left: 5px;
            font-weight: 400; /* Normal weight */
        }

        @media (max-width: 1024px) {
            .attemptedCount {
                display: none;
            }
        }

        .footer__questionWrapper___1tZ46.selected .attemptedCount {
            display: none;
        }

        .footer__subquestionWrapper___9GgoP {
            display: none;
            gap: 2px;
            margin-left: 10px;
        }

        .footer__questionWrapper___1tZ46.selected .footer__subquestionWrapper___9GgoP {
            display: flex;
        }

        .subQuestion {
            width: 32px;
            height: 32px;
            border: 1px solid #ccc;
            background: white;
            color: #333;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            border-radius: 2px;
        }

        .subQuestion.answered {
            background-color: #e9ecef;
            border-color: #ddd;
        }
        .subQuestion.correct {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }
        .subQuestion.incorrect {
            background-color: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .subQuestion:hover {
            background-color: #f0f0f0;
            border-color: #999;
        }

    

        .subQuestion.completed {
            background-color: #28a745;
            color: white;
            border-color: #28a745;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .footer__deliverButton___3FM07 {
            margin-left: auto;
            margin-right: 20px;
            background-color: #f0f0f0;
            color: #333;
            border: 1px solid #ccc;
            padding: 12px 20px;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s, border-color 0.2s;
            min-width: 170px;
            justify-content: center;
        }

        .footer__deliverButton___3FM07:hover {
            background-color: #e0e0e0;
            border-color: #bbb;
        }
        /* Success style for "My Results" button after checking */
        .footer__deliverButton___3FM07.success {
            background-color: #28a745;
            color: #fff;
            border-color: #28a745;
        }
        .footer__deliverButton___3FM07.success:hover {
            background-color: #218838;
            border-color: #1e7e34;
        }

        .footer__deliverButton___3FM07:disabled {
            background: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
            border-color: #ddd;
        }

        .fa-check::before {
            content: "✓";
        }

        .hidden {
            display: none;
        }

        /* Context Menu */
        .context-menu {
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            min-width: 140px;
        }

        .context-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:hover {
            background-color: #f8f9fa;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .highlight {
            background-color: #ffff00;
        }

        .comment-highlight {
            background-color: #90EE90;
            position: relative;
            cursor: help;
        }

        .comment-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            white-space: nowrap;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .comment-highlight:hover .comment-tooltip {
            opacity: 1;
        }

        .question {
            margin-bottom: 40px;
        }
        .question p {
            margin-bottom: 10px;
        }
        .question ul, .question .people-table {
            margin-top: 0;
        }
        .question-prompt {
            margin-bottom: 20px;
        }
        .question ul {
            list-style: none;
            padding-left: 0;
        }
        .question ul li {
            margin-bottom: 5px;
        }
        .answer-input {
            border: 1px solid #9aa3ad;
            border-radius: 4px;
            background-color: #fff;
            padding: 4px 8px;
            font-size: 16px;
            text-align: left; /* start typing from left */
            margin-right: 4px;
            width: 140px;
            max-width: 160px;
            min-width: 120px;
            word-break: break-word;
            overflow-wrap: break-word;
            white-space: normal;
            height: 28px;
            min-height: 28px;
            line-height: 1.2;
            vertical-align: middle;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }
        .answer-input::placeholder {
            color: #999;
            font-weight: bold;
            text-align: center; /* numbers centered until typing starts */
        }
        .answer-input:focus {
            outline: none;
            border-color: #2c6bed;
            border-width: 2px;
        }
        .answer-input.correct {
            border-color: #28a745;
            background-color: #e9f7ef;
        }
        .answer-input.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }
        .answer-input {
    z-index: 10;
    position: relative;
    pointer-events: auto;
}
        .drag-drop-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
            align-items: flex-start;
        }
        .recommendations-box {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 10px;
            min-height: 200px;
        }
        .drag-item {
            background: white;
    border: 1px solid #9c9c9c;
    font-weight: 600;
    padding: 0px 5px;
            border-radius: 4px;
            cursor: move;
            font-size: 16px;
            transition: all 0.2s;
            user-select: none;
        }
        .drag-item:hover {
            background: #e9ecef;
        }
        .drag-item.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }
        .drop-zone {
            border: 2px dashed #aaa;
            border-radius: 4px;
            height: 25px;
            margin-top: 19px;
            margin-bottom: 5px;
            transition: background-color 0.2s, border-color 0.2s;
            padding: 0.5px 5px;
            display: flex;
            align-items: center;
            position: relative;
            color: #b3b3b3;
            font-weight: 600;
            min-width: 200px;
            width: auto;
        }
        .drop-zone.drag-over {
            background-color: #e6f4ff;
            border-color: #4a90e2;
        }
        /* Letter pill displayed inside drop-zones */
        .drop-letter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 22px;
            height: 20px;
            padding: 0 6px;
            border: 1px solid #4a90e2;
            color: #0f5bd7;
            background: #eef5ff;
            border-radius: 9999px;
            font-weight: 700;
            cursor: move;
            user-select: none;
        }
        .drop-zone.correct {
            background-color: #e9f7ef;
            border-color: #28a745;
            border-style: solid;
        }
        .drop-zone.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
            border-style: solid;
        }
        .drop-zone .drag-item {
            cursor: default;
        }
        .drag-item.selected {
            border-color: #4a90e2;
            box-shadow: 0 0 0 1px #4a90e2;
        }
        .questions-container {
            width: 50%;
        }
        /* When transcription (results mode) is visible, give questions container 80% of left panel */
        .main-container.results-mode .questions-container {
            width: 80%;
        }
        audio {
            width: 100%;
            margin-bottom: 20px;
        }
        .part-header {
            background-color: #f1f2ec;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #e0e0e0;
        }
        .part-header p {
            margin: 0;
        }

        .question li.correct {
            color: #155724;
            font-weight: bold;
        }
        .question li.incorrect {
            color: #721c24;
        }
        .question li.correct::before {
            content: '✔ ';
            color: #28a745;
        }
        .question li.incorrect::before {
            content: '✖ ';
            color: #dc3545;
        }

        .example-box {
            margin: 20px 0;
        }

        .timer-container {
            display: none; /* Timer hidden */
            color: #333;
            font-size: 16px;
            font-weight: 500;
        }
        .timer-container .timer-tooltip {
            display: none;
        }

        .audio-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(40, 40, 40, 0.9);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }
        .audio-modal-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            max-width: 500px;
            padding: 20px;
        }
        .audio-modal-content p {
            font-size: 16px;
            line-height: 1.5;
            color: #eee;
        }
        .audio-modal-icon {
            margin-bottom: 20px;
        }
        .modal-play-btn {
            background-color: #000;
            color: white;
            border: 1px solid white;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        .modal-play-btn:hover {
            background-color: #333;
        }
        #goto-widget {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        #goto-input {
            width: 80px;
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #goto-btn {
            padding: 4px 10px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            border-radius: 4px;
            cursor: pointer;
        }

        @keyframes flash {
            0% { background-color: #e6f4ff; }
            100% { background-color: transparent; }
        }

        .question.flash {
            animation: flash 1s ease-out;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 8px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .modal-header h2 {
            font-size: 24px;
            color: #333;
        }
        .modal-close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #888;
            line-height: 1;
        }
        .modal-close-btn:hover {
            color: #333;
        }

        #part-2 .questions-container {
width: 75%;
        }
        #score-summary {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        #result-details table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        #result-details th, #result-details td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
            vertical-align: middle;
        }
        #result-details th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        #result-details td:nth-child(1) {
            font-weight: bold;
            text-align: center;
        }
        .result-correct {
            color: #28a745;
            font-weight: bold;
        }
        .result-incorrect {
            color: #dc3545;
            font-weight: bold;
        }

        .context-menu-icon {
            width: 16px;
            height: 16px;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }

        .matching-container {
            display: flex;
            justify-content: space-between;
            gap: 40px;
            margin-top: 20px;
            align-items: flex-start;
        }
        /* Two-column drag-and-drop layout like screenshot */
        .dnd-col-title { font-weight: 700; margin-bottom: 10px; }
        .matching-question-container { display: flex; gap: 30px; align-items: flex-start; }
        .matching-options-bank { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        .matching-questions { flex: 2; display: flex; flex-direction: column; gap: 24px; }
        .matching-questions .matching-question-item { display: flex; align-items: center; gap: 16px; padding: 6px 0; }
        .matching-questions .matching-question-item span { min-width: 180px; }
        .matching-questions .drop-zone { width: 100%; min-width: 360px; height: 34px; border: 2px dashed #aab3bd; border-radius: 4px; background: #fff; display: flex; align-items: center; padding: 0 8px; justify-content: flex-start; text-align: left; }
        .matching-questions .drop-zone .placeholder { color: #6b7280; font-weight: 700; }
        .matching-options-bank .drag-item { border-radius: 6px; padding: 6px 12px; background: #ffffff; border: 1px solid #d1d5db; font-weight: 600; box-shadow: 0 1px 0 rgba(0,0,0,0.02); }
        .matching-table {
            flex: 4;
            border-collapse: collapse;
        }
        .matching-table th, .matching-table td {
            padding: 6px 12px;
            text-align: left;
            vertical-align: middle;
        }
        .matching-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        .matching-table .drop-zone {
            /* Unify with global drop-zone styling */
            border: 2px dashed #aaa;
            border-radius: 4px;
            height: 25px;
            width: 100%;
            max-width: none;
            min-width: 200px;
            padding: 0.5px 5px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            flex-wrap: nowrap;
            background-color: transparent;
            word-break: break-word;
            overflow-wrap: break-word;
            text-align: left;
            line-height: 1.2;
            color: #b3b3b3;
            font-weight: 600;
        }
        .matching-table .drop-zone .drag-item {
            width: auto;
            max-width: none;
            text-align: left;
            padding: 6px 8px;
            font-size: 14px;
            line-height: 1.2;
            word-break: break-word;
            overflow-wrap: break-word;
            box-sizing: border-box;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 2px;
        }
        .matching-options-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
            background-color: transparent;
            padding: 0;
            border: none;
            min-height: 250px;
            min-width: 280px; /* ensure enough width for long option text to stay on one line */
        }
        .matching-options-list .drag-item {
            width: 100%;
        }
        .matching-question-item .drop-zone .placeholder {
            color: #999;
            font-weight: bold;
        }

        /* Clickable cell styles for matching questions */
        .clickable-cell {
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
            min-width: 50px;
            min-height: 50px;
            border: 2px solid #e0e0e0;
            position: relative;
            background-color: #f8f9fa;
            margin: 2px;
        }
       
        .clickable-cell:hover {
            background-color: #e6f4ff;
            border-color: #4a90e2;
        }
        .clickable-cell.selected {
            background-color: #75a8e4 !important;
            color: white !important;
        }
       
        .clickable-cell.correct {
            background-color: #28a745 !important;
            color: white !important;
        }
        .clickable-cell.correct::after {
            content: "✓";
            font-weight: bold;
        }
        .clickable-cell.incorrect {
            background-color: #dc3545 !important;
            color: white !important;
        }
        .clickable-cell.incorrect::after {
            content: "✗";
            font-weight: bold;
        }
        
        /* Clickable cell styles for questions 27-30 */
        .clickable-cell {
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
            min-width: 50px;
            min-height: 50px;
            border: 2px solid #e0e0e0;
            position: relative;
            background-color: #f8f9fa;
            margin: 2px;
        }
       
        .clickable-cell:hover {
            background-color: #e6f4ff;
            border-color: #4a90e2;
        }
        .clickable-cell.selected {
            background-color: #4a90e2 !important;
            color: white !important;
        }
        
        .clickable-cell.correct {
            background-color: #28a745 !important;
            color: white !important;
        }
        
        .clickable-cell.incorrect {
            background-color: #dc3545 !important;
            color: white !important;
        }
        

        
        .statement {
            font-weight: 500;
            padding-right: 20px;
        }

        .option strong,
        .question ul li label strong {
            display: none;
        }

        /* Mobile selection toolbar */
        .mobile-selection-menu {
            position: absolute;
            background: #333;
            color: #fff;
            padding: 6px 10px;
            border-radius: 6px;
            display: flex;
            gap: 8px;
            z-index: 3000;
            box-shadow: 0 2px 6px rgba(0,0,0,0.25);
        }
        .mobile-selection-menu button {
            background: transparent;
            border: 1px solid #fff;
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        .mobile-selection-menu.hidden {
            display: none;
        }

        /* === Matching table styling for Questions 13-16 === */
        .matching-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .matching-table th,
        .matching-table td {
            border: 1px solid #ddd;
            padding: 8px 4px;
            vertical-align: middle;
            text-align: center;
        }
        .matching-table .clickable-cell {
            padding: 8px 4px;
            min-width: 50px;
            min-height: 50px;
        }
        .matching-table th {
            background-color: #1e6de6;
            color: #ffffff;
            font-weight: 600;
            text-align: center;
        }
        .matching-table th:first-child {
            text-align: left;
            background-color: #f8f9fa;
            color: #333;
        }
        .matching-table tbody td:first-child {
            font-weight: 500;
            text-align: left;
            background-color: #f8f9fa;
        }
        .matching-table tr:nth-child(even) td {
            background-color: #f8faff;
        }

        /* === MCQ table styling for Questions 11-15 === */
        .mcq-table {
            width: 100%;
            border-collapse: collapse;
        }
        .mcq-table th,
        .mcq-table td {
            border: 1px solid #ddd;
            padding: 8px 12px;
            vertical-align: middle;
            text-align: center;
        }
        .mcq-table th {
            background-color: #1e6de6; /* vibrant blue header like screenshot */
            color: #ffffff;
            font-weight: 600;
            text-align: center;
        }
        .mcq-table th:first-child {
            text-align: left;
        }
        .mcq-table tbody td:first-child {
            font-weight: 500;
            text-align: left;
        }
        .mcq-table tr:nth-child(even) td {
            background-color: #f8faff; /* subtle alternating row colour */
        }
        .mcq-table input[type="radio"] {
            transform: scale(1.1);
            cursor: pointer;
        }
        /* list of options (A, B, C) shown above the table */
        .mcq-options {
            list-style: none;
            padding-left: 0;
            margin: 10px 0;
        }
        .mcq-options li {
            margin-bottom: 4px;
            font-size: 16px;
        }

        /* MCQ design: full-width selectable panels */
        .multi-choice-question { margin: 12px 0 18px; }
        .multi-choice-option { display:block; width:100%; padding: 12px 14px;  background-color: #fff; border: 1px solid transparent;  transition: background-color 0.2s ease, border-color 0.2s ease; }
        .multi-choice-option:hover { background-color: #f1f7ff; border-color: #c6dcfb; }
        .multi-choice-option:has(input[type="radio"]:checked) { background-color: #cfe3f9; }
        .multi-choice-option label { display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 16px; width:100%; }

        .aligned-form .question-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .aligned-form .question-label {
            width: 230px;
            padding-right: 10px;
        }

        /* Responsive adjustments for tablets */
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }
            .right-panel, .main-container.results-mode .right-panel {
                display: none;
            }
            .left-panel, .main-container.results-mode .left-panel {
                width: 100%;
                padding: 20px 10px;
                height: auto; /* Reset height for mobile */
            }
            .questions-container {
                width: 100%;
            }
        }

        .single-choice label.correct {
            color: #155724;
            font-weight: bold;
        }
        .single-choice label.correct::before {
            content: '✔ ';
            color: #28a745;
        }
        .single-choice label.incorrect {
            color: #721c24;
            text-decoration: line-through;
        }
        .single-choice label.incorrect::before {
            content: '✖ ';
            color: #dc3545;
        }
        .mcq-table tbody tr.correct {
            background-color: #d4edda !important;
            color: #155724;
            font-weight: bold;
        }
        .mcq-table tbody tr.incorrect {
            background-color: #f8d7da !important;
            text-decoration: line-through;
        }
        .mcq-table tbody tr.incorrect td {
            color: #721c24;
        }

        /* New Audio Player Styles */
        .audio-player-container {
            position: fixed;
            top: 65px;
            left: 50%;
            transform: translateX(-50%);
            width: 500px;
            max-width: 90%;
            height: 40px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            z-index: 99;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .main-container {
            margin-top: 115px;
        }
        .player-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .player-btn svg {
            width: 20px;
            height: 20px;
            fill: #333;
        }
        .progress-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #progress-bar {
            flex-grow: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 4px;
            background: #ddd;
            outline: none;
            border-radius: 3px;
            cursor: pointer;
        }
        #progress-bar::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4a90e2;
            cursor: pointer;
        }
        #progress-bar::-moz-range-thumb {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4a90e2;
            cursor: pointer;
            border: none;
        }
        #current-time, #total-duration {
            font-size: 12px;
            color: #555;
            min-width: 35px;
            text-align: center;
        }
        .controls-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .volume-container {
            display: flex;
            align-items: center;
            position: relative;
        }
        #new-volume-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 60px;
            height: 3px;
            background: #ccc;
            outline: none;
            border-radius: 2px;
            cursor: pointer;
            margin-left: 8px;
            display: block; 
        }
    
        #new-volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #333;
        }
        #new-volume-slider::-moz-range-thumb {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #333;
            border: none;
        }
        .speed-container {
            position: relative;
        }
        #speed-btn {
            font-size: 12px;
            font-weight: 600;
            color: #333;
            background-color: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 4px;
            padding: 4px 8px;
        }
        #speed-options {
            position: absolute;
            top: calc(100% + 5px); /* Position below the button with a small gap */
            right: 0;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 100;
        }
        #speed-options div {
            padding: 8px 15px;
            cursor: pointer;
        }
        #speed-options div:hover {
            background-color: #f0f0f0;
        }

        /* Flowchart styles */
        .flowchart-container {
            border: 1px solid #ccc;
            padding: 0 20px;
        }
        .flowchart-step {
            text-align: center;
            margin: 0;
            padding: 20px 0;
            border-top: 1px solid #ddd;
        }
        .flowchart-step:first-child {
            border-top: none;
            padding-top: 20px;
            margin-top: 0;
        }
        .flowchart-arrow {
            text-align: center;
            margin: 0;
            padding: 15px 0;
            font-size: 20px;
            color: #555;
            border-top: 1px solid #ddd;
        }
        .flowchart-split {
            display: flex;
            justify-content: space-between;
            align-items: stretch;
            gap: 20px;
            border-top: 1px solid #ddd;
        }
        .flowchart-split-col {
            width: 48%;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .flowchart-split .flowchart-step {
            border-top: none;
            padding-top: 0;
            margin-top: 0;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 0;
        }
        .flowchart-split .flowchart-arrow {
            border-top: none;
            padding: 15px 0;
        }


        /* Responsive adjustments for tablets */
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }
            .right-panel, .main-container.results-mode .right-panel {
                display: none;
            }
            .left-panel, .main-container.results-mode .left-panel {
                width: 100%;
                padding: 20px 10px;
                height: auto; /* Reset height for mobile */
            }
            .questions-container {
                width: 100%;
            }
            
            /* Adjust input boxes for tablets */
            .answer-input {
                width: 90px;
                max-width: 110px;
                font-size: 15px;
            }
            
            .drop-zone {
                max-width: 110px;
                min-width: 90px;
            }
            
            .matching-table .drop-zone {
                max-width: 110px;
                min-width: 90px;
            }
        }
        
        /* Responsive adjustments for mobile phones */
        @media (max-width: 768px) {
            .answer-input {
                width: 80px;
                max-width: 100px;
                font-size: 14px;
                padding: 2px 4px;
            }
            
            .drop-zone {
                max-width: 100px;
                min-width: 80px;
                font-size: 14px;
            }
            
            .matching-table .drop-zone {
                max-width: 100px;
                min-width: 80px;
            }
            
            .drag-item {
                font-size: 13px;
                padding: 4px 6px;
            }
            
            .matching-table .drop-zone .drag-item {
                font-size: 12px;
            }
            
            /* Ensure drag-drop containers are more mobile-friendly */
            .drag-drop-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .matching-container {
                flex-direction: column;
                gap: 20px;
            }
        }
        
        /* Extra small screens */
        @media (max-width: 480px) {
            .answer-input {
                width: 70px;
                max-width: 90px;
                font-size: 13px;
            }
            
            .drop-zone {
                max-width: 90px;
                min-width: 70px;
            }
            
            .matching-table .drop-zone {
                max-width: 90px;
                min-width: 70px;
            }
        }

        /* ===== Imported designs from Reading 4.html ===== */
        /* TRUE/FALSE/NOT GIVEN styles */
        .tf-question { margin-bottom: 25px; padding: 10px 0; border-radius: 4px; }
        .tf-question-line { display: flex; align-items: flex-start; margin-bottom: 15px; padding: 5px 0; border-radius: 4px; }
        .tf-question-number, .question-number-box { border: 2px solid #ccc; padding: 2px 8px; margin-right: 10px; border-radius: 3px; font-weight: bold; display: inline-block; }
        .tf-question.active-question .tf-question-number { border-color: #4a90e2; }
        .tf-question-text { padding-top: 3px; }
        .tf-options { padding-left: 5px; }
        .tf-option { display: flex; align-items: center; padding: 10px 12px; background-color: #fff; transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease; }
        .tf-option:hover { background-color: #f1f7ff; border-color: #c6dcfb; }
        .tf-option.correct { background-color: #d4edda !important; border-color: #28a745 !important; }
        .tf-option.incorrect { background-color: #f8d7da !important; border-color: #dc3545 !important; }
        .tf-option input[type="radio"] { margin-right: 10px; transform: scale(1.2); }
        .tf-question.correct .tf-question-line { background-color: #e9f7ef; }
        .tf-question.incorrect .tf-question-line { background-color: #f8d7da; }

        /* Multi-choice question styles */
        .multi-choice-question { margin-bottom: 20px; padding: 10px; border-radius: 4px; border: 3px solid transparent; }
        .multi-choice-question .question-prompt p > strong:first-child { display: inline-flex; align-items: center; justify-content: center; min-width: 24px; padding: 2px 6px; margin-right: 8px; border: 1px solid #d0d7e2; border-radius: 6px; background: #fff; }
        .multi-choice-question.active-question .question-prompt p > strong:first-child { border-color: #4a90e2; border-width: 2px; }
        .multi-choice-option { padding: 10px 12px; background-color: #fff; transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease; }
        .multi-choice-option:hover { background-color: #f1f7ff; border-color: #c6dcfb; }
        .multi-choice-option.correct { background-color: #d4edda !important;  }
        .multi-choice-option.incorrect { background-color: #f8d7da !important;  }
        .multi-choice-option label { display: flex; align-items: center; cursor: pointer; font-size: 16px; }
        .multi-choice-option input[type="checkbox"], .multi-choice-option input[type="radio"] { margin-right: 12px; transform: scale(1.3); accent-color: #4a90e2; }

        /* Checkbox TWO-answers block (match screenshot) */
        .checkbox-question .question-prompt p > strong:first-child {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 24px;
           
            background: #fff;
        }
        .checkbox-group { display: flex; flex-direction: column;  }
        .checkbox-group label { display: flex; align-items: center; padding: 10px 12px; border: 1px solid transparent; background: #fff; transition: background-color 0.2s, border-color 0.2s; }
        .checkbox-group label:hover { background: #f1f7ff; border-color: #c6dcfb; }
        .checkbox-group label:has(input[type="checkbox"]:checked) { background: #cfe3f9; }
        .checkbox-group input[type="checkbox"] { margin-right: 10px; transform: scale(1.2); }
        .checkbox-group label.correct { background-color: #d4edda !important; }
        .checkbox-group label.incorrect { background-color: #f8d7da !important;  }
        .checkbox-group label.correct::before { content: '✔ '; color: #28a745; font-weight: 600; margin-right: 6px; }
        .checkbox-group label.incorrect::before { content: '✖ '; color: #dc3545; font-weight: 600; margin-right: 6px; }

        /* Drag & Drop enhancements */
        /* When filled, hide zone border and show a blue outlined pill around the dropped option */
        .drop-zone.filled { 
            background: transparent; 
            border: none !important; 
            padding: 0; 
            justify-content: flex-start; 
            width: auto;
            min-width: fit-content;
        }
        .drop-zone.filled .drag-item { 
            width: auto; 
            height: auto; 
            display: inline-block; 
            white-space: nowrap; 
            border: 1px solid #2c6bed; 
            border-radius: 4px; 
            padding: 2px 6px; 
            font-weight: 600; 
            background: #fff; 
            color: #222; 
        }

        /* ===== Results Modal UI ===== */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.55); display: flex; align-items: center; justify-content: center; z-index: 3000; padding: 20px; }
        .modal-content { background: #ffffff; width: 100%; max-width: 900px; max-height: 85vh; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.25); overflow: hidden; display: flex; flex-direction: column; }
        .modal-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; border-bottom: 1px solid #e5e7eb; background: #f8fafc; position: sticky; top: 0; z-index: 1; }
        .modal-header h2 { margin: 0; font-size: 20px; font-weight: 700; color: #111827; }
        .modal-close-btn { background: transparent; border: none; font-size: 26px; line-height: 1; cursor: pointer; color: #6b7280; }
        .modal-close-btn:hover { color: #111827; }
        .modal-body { padding: 16px 18px; overflow: auto; }
        #score-summary { font-size: 16px; font-weight: 600; color: #111827; background: #f1f5f9; border: 1px solid #e2e8f0; padding: 10px 12px; border-radius: 8px; display: inline-block; }
        .result-controls { display: flex; align-items: center; gap: 12px; margin: 12px 0; }
        .result-controls .spacer { flex: 1; }
        .result-controls label { display: inline-flex; align-items: center; gap: 6px; color: #374151; }
        .btn-secondary { padding: 6px 10px; border: 1px solid #cbd5e1; border-radius: 6px; background: #ffffff; color: #111827; cursor: pointer; }
        .btn-secondary:hover { background: #f8fafc; }
        #result-details { overflow: auto; }
        #result-details table { width: 100%; border-collapse: collapse; border: 1px solid #e5e7eb; }
        #result-details th, #result-details td { padding: 10px 12px; border-bottom: 1px solid #e5e7eb; text-align: left; font-size: 14px; }
        #result-details thead th { position: sticky; top: 0; background: #f1f5f9; z-index: 1; }
        #result-details tr:nth-child(even) td { background: #fafafa; }
        #result-details td.result-correct { color: #0f5132; font-weight: 600; }
        #result-details td.result-incorrect { color: #842029; font-weight: 600; }
    </style>
</head>
<body>
    <div class="header">
        <div class="timer-container">
            <span class="timer-display">60:00</span>
        </div>
        <a href="https://t.me/+E-Yu7bIaFxNkOGRl" target="_blank" class="telegram-link">
            MINDLESS WRITER
        </a>
        <div class="header-icons">
        
        </div>
    </div>

    <div class="audio-player-container">
        <button id="play-pause-btn" class="player-btn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
        </button>
        <div class="progress-container">
            <span id="current-time">0:00</span>
            <input type="range" id="progress-bar" value="0" step="1" style="width: 100%;">
            <span id="total-duration">0:00</span>
        </div>
        <div class="controls-container">
            <div class="volume-container">
                <button id="volume-btn" class="player-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                </button>
                <input type="range" id="new-volume-slider" min="0" max="1" step="0.01" value="1">
            </div>
            <div class="speed-container">
                <button id="speed-btn" class="player-btn">1x</button>
                <div id="speed-options" class="hidden">
                    <div data-speed="0.5">0.5x</div>
                    <div data-speed="0.75">0.75x</div>
                    <div data-speed="1">1x</div>
                    <div data-speed="1.25">1.25x</div>
                    <div data-speed="1.5">1.5x</div>
                    <div data-speed="2">2x</div>
                </div>
            </div>
        </div>
    </div>

    <div class="main-container">
        <!-- Left Panel -->
        <div class="left-panel">
            
            <div id="part-1" class="question-part">
                <div class="part-header">
                    <p><strong>Part 1</strong></p>
                    <p>Listen and answer questions 1–10.</p>
                </div>
                <div class="questions-container">
                    <div class="question">
                        <div class="question-prompt">
                            <p><strong>Questions 1-6</strong></p>
                            <p>Complete the form below. Write <strong>NO MORE THAN TWO WORDS AND/OR A NUMBER</strong> for each answer.</p>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <p class="centered-title">Moving Company Service Report</p>
                            
                            <ul >
                                <li style="margin-bottom: 8px;"><strong>Full Name:</strong> Jane Bond</li>
                                <li style="margin-bottom: 8px;"><strong>Phone Number:</strong> <input type="text" id="q1" class="answer-input" placeholder="1" autocomplete="off"></li>
                            
                                <li style="margin-bottom: 8px;"><strong>USA Address:</strong></li>
                                <ul style="padding-left: 40px; list-style: disc;">
                                    <li>509 <input type="text" id="q2" class="answer-input" placeholder="2" autocomplete="off"></li>
                                    <li>1137 <input type="text" id="q3" class="answer-input" placeholder="3" autocomplete="off">, Seattle</li>
                                </ul>
                                <li style="margin-bottom: 8px;"><strong>Packing Day:</strong> <input type="text" id="q4" class="answer-input" placeholder="4" autocomplete="off"></li>
                                <li style="margin-bottom: 8px;"><strong>Date:</strong> 11th March</li>
                                <li style="margin-bottom: 8px;"><strong>Clean-up by:</strong> 5:00 p.m.</li>
                                <li style="margin-bottom: 8px;"><strong>Day:</strong> <input type="text" id="q5" class="answer-input" placeholder="5" autocomplete="off"> 14th</li>
                                <li style="margin-bottom: 8px;"><strong>About the Price:</strong> Rather expensive</li>
                                <li style="margin-bottom: 8px;"><strong>Storage Time:</strong> <input type="text" id="q6" class="answer-input" placeholder="6" autocomplete="off"></li>
                            </ul>
                        </div>
                        
                        <div class="question" style="margin-top: 40px;">
                            <div class="question-prompt">
                                <p><strong>Questions 7-10</strong></p>
                                <p>Where does the speaker decide to put items in?</p>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <div style="display: flex; gap: 30px; margin-bottom: 20px;">
                                    <div style="flex: 1;">
                                        <p style="font-weight: bold; margin-bottom: 15px;">Options</p>
                                        <p><strong>A</strong> in emergency pack</p>
                                        <p><strong>B</strong> in personal package</p>
                                        <p><strong>C</strong> in storage with the furniture</p>
                                    </div>
                                    <div style="flex: 1;">
                                        <p style="font-weight: bold; margin-bottom: 15px;">Items</p>
                                        <p><strong>7</strong>&nbsp;&nbsp;cutlery and dishes <select id="q7" class="answer-input" style="width: 100px; margin-left: 10px;">
                                            <option value="">Select</option>
                                            <option value="A">A</option>
                                            <option value="B">B</option>
                                            <option value="C">C</option>
                                        </select></p>
                                        <p><strong>8</strong>&nbsp;&nbsp;kettle <select id="q8" class="answer-input" style="width: 100px; margin-left: 10px;">
                                            <option value="">Select</option>
                                            <option value="A">A</option>
                                            <option value="B">B</option>
                                            <option value="C">C</option>
                                        </select></p>
                                        <p><strong>9</strong>&nbsp;&nbsp;alarm clock <select id="q9" class="answer-input" style="width: 100px; margin-left: 10px;">
                                            <option value="">Select</option>
                                            <option value="A">A</option>
                                            <option value="B">B</option>
                                            <option value="C">C</option>
                                        </select></p>
                                        <p><strong>10</strong>&nbsp;&nbsp;CD player <select id="q10" class="answer-input" style="width: 100px; margin-left: 10px;">
                                            <option value="">Select</option>
                                            <option value="A">A</option>
                                            <option value="B">B</option>
                                            <option value="C">C</option>
                                        </select></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="part-2" class="question-part hidden">
                <div class="part-header">
                    <p><strong>Part 2</strong></p>
                    <p>Listen and answer questions 11–20.</p>
                </div>
                <div class="questions-container">
                    <div class="question">
                        <div class="question-prompt">
                            <p><strong>Questions 11-17</strong></p>
                            <p>Complete the sentences. Write <strong>ONE WORD ONLY</strong> for each answer.</p>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <ul style="list-style-type: disc; padding-left: 20px;">
                                <li style="margin-bottom: 15px;">It is important for everyone to know simple first aid <input type="text" id="q11" class="answer-input" placeholder="11" autocomplete="off"></li>
                                <li style="margin-bottom: 15px;">After an accident, one must firstly be aware of <input type="text" id="q12" class="answer-input" placeholder="12" autocomplete="off"></li>
                                <li style="margin-bottom: 15px;">After that, the first-aider must <input type="text" id="q13" class="answer-input" placeholder="13" autocomplete="off"></li>
                                <li style="margin-bottom: 15px;">Clearing of airways may not happen when patients are <input type="text" id="q14" class="answer-input" placeholder="14" autocomplete="off"></li>
                                <li style="margin-bottom: 15px;">The mouth must be checked for <input type="text" id="q15" class="answer-input" placeholder="15" autocomplete="off"></li>
                                <li style="margin-bottom: 15px;">CPR must be done if breathing is absent or <input type="text" id="q16" class="answer-input" placeholder="16" autocomplete="off"></li>
                                <li style="margin-bottom: 15px;">CPR must be done up to the arrival of <input type="text" id="q17" class="answer-input" placeholder="17" autocomplete="off"></li>
                            </ul>
                        </div>
                    </div>

                    <div class="question">
                        <div class="question-prompt" style="margin-top: 40px;">
                            <p><strong>Questions 18-20</strong></p>
                            <p>Choose <strong>THREE</strong> correct answers.</p><br>
                            <p><strong>18-20</strong>&nbsp;&nbsp;Which <strong>THREE</strong> pieces of advice does the first-aid officer say are most important?</p>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="q18-20" value="A"> Have proper equipment</label>
                                <label><input type="checkbox" name="q18-20" value="B"> Give regular first-aid training</label>
                                <label><input type="checkbox" name="q18-20" value="C"> Have a safety officer</label>
                                <label><input type="checkbox" name="q18-20" value="D"> Instil safe behaviour</label>
                                <label><input type="checkbox" name="q18-20" value="E"> Put posters on walls</label>
                                <label><input type="checkbox" name="q18-20" value="F"> Have safety meetings</label>
                                <label><input type="checkbox" name="q18-20" value="G"> Have first-aid boxes</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="part-3" class="question-part hidden">
                <div class="part-header">
                    <p><strong>Part 3</strong></p>
                    <p>Listen and answer questions 21–30.</p>
                </div>
                <div class="questions-container">
                    <div class="question">
                        <div class="question-prompt">
                            <p><strong>Questions 21-25</strong></p>
                            <p>Choose the correct answer.</p>
                        </div>
                        
                        <div style="margin-bottom: 18px;">
                            <p><strong>21</strong>&nbsp;&nbsp;Nicole received the best information from the</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q21" value="A"> staff.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q21" value="B"> students.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q21" value="C"> cleaners.</label></div>
                            </div>

                            <p><strong>22</strong>&nbsp;&nbsp;The product used most wastefully was</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q22" value="A"> copying paper.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q22" value="B"> plastic.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q22" value="C"> paper plates and cups.</label></div>
                            </div>

                            <p><strong>23</strong>&nbsp;&nbsp;The proportion of interviewed people who expressed concern over waste was</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q23" value="A"> 30%.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q23" value="B"> 45%.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q23" value="C"> 55%.</label></div>
                            </div>

                            <p><strong>24</strong>&nbsp;&nbsp;The proportion who claim they take action over this problem was</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q24" value="A"> 10%.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q24" value="B"> one third</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q24" value="C"> one half</label></div>
                            </div>
                            
                            <p><strong>25</strong>&nbsp;&nbsp;Nicole thinks many people do nothing because they are</p>
                            <div class="multi-choice-question">
                                <div class="multi-choice-option"><label><input type="radio" name="q25" value="A"> lazy.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q25" value="B"> uncaring.</label></div>
                                <div class="multi-choice-option"><label><input type="radio" name="q25" value="C"> uninformed.</label></div>
                            </div>
                        </div>
                    </div>

                    <div class="question">
                        <div class="question-prompt" style="margin-top: 40px;">
                            <p><strong>Questions 26-30</strong></p>
                            <p>Complete the flowchart. Write <strong>ONE WORD ONLY</strong> for each answer.</p>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <div class="flowchart-container">
                                <p class="centered-title">Procedure to Reduce Copying Waste</p>
                                
                                <div class="flowchart-step">
                                    <p><input type="text" id="q26" class="answer-input" placeholder="26" autocomplete="off"> that the staff do double-sided copying.</p>
                                </div>
                                
                                <div class="flowchart-arrow">↓</div>
                                
                                <div class="flowchart-step">
                                    <p>Unwanted copies are <input type="text" id="q27" class="answer-input" placeholder="27" autocomplete="off"> into a special recycling tray.</p>
                                </div>
                                
                                <div class="flowchart-arrow">↓</div>
                                
                                <div class="flowchart-step">
                                    <p><input type="text" id="q28" class="answer-input" placeholder="28" autocomplete="off"> these clearly, for easy reuse.</p>
                                </div>
                                
                                <div class="flowchart-arrow">↓</div>
                                
                                <div class="flowchart-step">
                                    <p>Stack them in a special copying tray each morning.</p>
                                </div>
                                
                                <div class="flowchart-arrow">↓</div>
                                
                                <div class="flowchart-step">
                                    <p><input type="text" id="q29" class="answer-input" placeholder="29" autocomplete="off"> codes which allow each user to access this tray.</p>
                                </div>
                                
                                <div class="flowchart-arrow">↓</div>
                                
                                <div class="flowchart-step">
                                    <p>Give highest users a <input type="text" id="q30" class="answer-input" placeholder="30" autocomplete="off"> (e.g. cinema tickets).</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="part-4" class="question-part hidden">
                <div class="part-header">
                    <p><strong>Part 4</strong></p>
                    <p>Listen and answer questions 31–40.</p>
                </div>
                <div class="questions-container">
                    <div class="question">
                        <div class="question-prompt">
                            <p><strong>Questions 31-37</strong></p>
                            <p>Complete the table below. Write <strong>NO MORE THAN TWO WORDS AND/OR A NUMBER</strong> for each answer.</p>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <p class="centered-title">Talking about the history of bikes</p>
                            
                            <div style="overflow-x: auto; margin: 20px 0;">
                                <table style="width: 100%; border-collapse: collapse; border: 1px solid #ccc;">
                                    <thead>
                                        <tr style="background-color: #f5f5f5;">
                                            <th style="border: 1px solid #ccc; padding: 12px; text-align: left; font-weight: bold;">Years/Time</th>
                                            <th style="border: 1px solid #ccc; padding: 12px; text-align: left; font-weight: bold;">Feature</th>
                                            <th style="border: 1px solid #ccc; padding: 12px; text-align: left; font-weight: bold;">Advantage</th>
                                            <th style="border: 1px solid #ccc; padding: 12px; text-align: left; font-weight: bold;">Disadvantage</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td style="border: 1px solid #ccc; padding: 12px;">1830s</td>
                                            <td style="border: 1px solid #ccc; padding: 12px;">wooden wheels covered with metal</td>
                                            <td style="border: 1px solid #ccc; padding: 12px;">need <input type="text" id="q31" class="answer-input" placeholder="31" autocomplete="off" style="width: 80px;"> than walking</td>
                                            <td style="border: 1px solid #ccc; padding: 12px;">quite <input type="text" id="q32" class="answer-input" placeholder="32" autocomplete="off" style="width: 80px;"></td>
                                        </tr>
                                        <tr>
                                            <td style="border: 1px solid #ccc; padding: 12px;"><input type="text" id="q33" class="answer-input" placeholder="33" autocomplete="off" style="width: 80px;"></td>
                                            <td style="border: 1px solid #ccc; padding: 12px;">Chain and sprocket are <input type="text" id="q34" class="answer-input" placeholder="34" autocomplete="off" style="width: 80px;"></td>
                                            <td style="border: 1px solid #ccc; padding: 12px;">easier and <input type="text" id="q35" class="answer-input" placeholder="35" autocomplete="off" style="width: 80px;"> ride</td>
                                            <td style="border: 1px solid #ccc; padding: 12px;">harder to balance</td>
                                        </tr>
                                        <tr>
                                            <td style="border: 1px solid #ccc; padding: 12px;">1880s</td>
                                            <td style="border: 1px solid #ccc; padding: 12px;">use <input type="text" id="q36" class="answer-input" placeholder="36" autocomplete="off" style="width: 80px;"></td>
                                            <td style="border: 1px solid #ccc; padding: 12px;">more comfortable</td>
                                            <td style="border: 1px solid #ccc; padding: 12px;">The faster you go, the more you feel every bump.</td>
                                        </tr>
                                        <tr>
                                            <td style="border: 1px solid #ccc; padding: 12px;">1890s</td>
                                            <td style="border: 1px solid #ccc; padding: 12px;">equal-sized wheels</td>
                                            <td style="border: 1px solid #ccc; padding: 12px;"><input type="text" id="q37" class="answer-input" placeholder="37" autocomplete="off" style="width: 80px;"></td>
                                            <td style="border: 1px solid #ccc; padding: 12px;">dangerous before brakes appeared</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="question">
                        <div class="question-prompt" style="margin-top: 40px;">
                            <p><strong>Questions 38-40</strong></p>
                            <p>Choose <strong>THREE</strong> correct answers.</p><br>
                            <p><strong>38-40</strong>&nbsp;&nbsp;The invention of different gears on a bicycle affected which <strong>THREE</strong> of the following?</p>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="q38-40" value="A"> Wheel size</label>
                                <label><input type="checkbox" name="q38-40" value="B"> Balance</label>
                                <label><input type="checkbox" name="q38-40" value="C"> Rate of speed</label>
                                <label><input type="checkbox" name="q38-40" value="D"> The back wheel</label>
                                <label><input type="checkbox" name="q38-40" value="E"> Safety</label>
                                <label><input type="checkbox" name="q38-40" value="F"> Downhill travel</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        <!-- Right Panel -->
    </div>
    <div class="right-panel">
        <div id="transcription-container">
            <h2>Transcription</h2>
            <div id="transcription-text"></div>
        </div>
    </div>

    <div id="transcription-data" style="display:none;">
        <div data-part="1"><strong>SECTION 1</strong>

You will hear a conversation between a clerk from a moving company and a woman who wants to relocate to the United States. First, you have some time to look at questions 1 to 6. You will see that there is an example which has been done for you. On this occasion only, the conversation relating to this will be played first.

Good morning, ma'am, and welcome to Australia's Moving Experience. How can I help you? Well, I hope you can help me. I'm so up in the air right now.

Just calm down now. Let me guess, you're moving and it has you a little confused. That's it exactly.

You see, I'm relocating to the United States next month and I'm having a hard time getting organised. Here, fill out your name and address and let me ask you a few questions. Oh, what should I call you? My name is Jane, Jane Bond.

The woman says that her full name is Jane Bond, so Jane Bond has been written in the space. Now we shall begin. You should answer the questions as you listen because you will not hear the recording a second time.

Listen carefully and answer questions 1 to 6. Good morning, ma'am, and welcome to Australia's Moving Experience. How can I help you? Well, I hope you can help me. I'm so up in the air right now.

Just calm down now. Let me guess, you're moving and it has you a little confused. That's it exactly.

You see, I'm relocating to the United States next month and I'm having a hard time getting organised. Here, fill out your name and address and let me ask you a few questions. Oh, what should I call you? My name is Jane, Jane Bond.

OK, Jane, first of all, what's your work phone number? In case I have any questions about things. My work phone is 9463 5550. But please try not to call me too often there.

My boss hates personal calls. So does mine, ma'am. So does mine.

And what address should we ship your things to? My new company is letting me stay temporarily at 509 Clark House. That's C-L-A-R-K. 1137 University Drive in Seattle.

Seattle. Beautiful city I hear. Mountains right beside the ocean almost.

Cooler than Australia too. OK, and when should we come pack your things? I guess that would be on Monday, March 11th. Do you want any help with an after-packing clean-up? We do that for a small additional charge.

Yes, that would be helpful. I promised the landlord I'd give her the keys back by 5pm on Thursday the 14th. Great.

We'll just schedule the clean-up for that day. That way, the place will smell clean and there'll be no dust. Well, you do think of everything.

Oh, how much is this going to cost? Here is a list of our basic prices. Oh dear. This seems rather expensive.

Yes, ma'am, but you're paying for the best. We're careful and we're fast. Like we say, the only thing we break are speed records getting you moved.

Well, maybe that's so. Oh, I nearly forgot to tell you. I don't want my furniture shipped with me.

I won't be looking for an apartment till after I arrive in America. Would it be possible to put my furniture in storage here for a month, then have it sent along later? Of course, we do that all the time. A couple of other things.

Here at A Moving Experience, we try to pack your things logically. We don't just throw stuff in boxes. Before you hear the rest of the conversation, you have some time to look at questions 7 to 10.

Now listen and answer questions 7 to 10. Do you have any special requests? You know, things you want packed in some special place, so you know where to find them. Like what? Oh, I don't know.

Things like dishes, maybe. Not to be rude, but you look like a lady who likes to eat. Ah, yes.

I need my dishes and things where I can find them quickly. Great. We'll put those dishes and cutlery in what we call the emergency pack.

Can you think of anything else? I do have an antique tea kettle my great-grandmother gave my mother. I wouldn't want to lose that. So I guess you'd better put that in storage with the furniture.

Grandma's tea kettle with the furniture. Got it. Say, how about things like your alarm clock? You don't want to miss your plane on the big day, right? Well, you certainly think of everything.

Yes, that's right. I'll also need my alarm clock where I can find it. Fine.

We'll put that in your personal package. And of course, we'll give you a list of where we pack everything. So all you'll have to do on Thursday the 14th is grab your luggage on your way out the door.

Um, I couldn't help noticing the new CD player you're carrying. Is that a Samsung? Why, yes it is. One of their best.

Cost me nearly $100, it did. Do you want to take special care of it? I mean, it's brand new. Take care of it, but nothing special.

You can just put it in storage with the furniture. That looks like everything we need here. I guess you're all set.

That was certainly quick. Thank you, young man. This has been a most moving experience.

That is the end of Section 1. You now have half a minute to check your answers. Now turn to Section 2.
        </div>
        <div data-part="2"><strong>SECTION 2</strong>

You will hear a first aid officer talking to a group of factory workers about emergency first aid. First, you have some time to look at questions 11 to 17.

Now listen carefully and answer questions 11 to 17. Hello, everyone. Now you know why I'm here.

You all work in a factory, and in this environment, there always remains a significant possibility of accidents happening, in which case first aid will be necessary. What is first aid? It is the provision of emergency on-site care when an injury occurs, and it is essential for everyone to know, if only simply, the steps which must be followed. There are, of course, minor injuries which may happen, not needing further medical care beyond the intervention of the first aider, but you can never be sure, thus the following steps must always be followed.

These can be abbreviated to the words DRABC. In other words, D-R-A-B-C. The D stands for danger, and that's the first issue to keep in mind.

When an accident happens, immediately ascertain that the environment is safe. That, for example, nothing else will fall or break or cause accidents. If you, the first aider, are also injured, the problem is even worse.

The R stands for respond. You must then ascertain the best response. Once all the danger has been eliminated, and the distress call sent out, the appropriate action is, obviously, to help the injured party.

All right, that leads to A, which stands for airway. In order to stay alive, all people need to have an open airway to allow breathing. A conscious person will automatically clear their own airway.

But if unconscious, this may not happen. The brain is stopped or hindered from properly directing the body, and, obviously, in the worst case, death can result. For this reason, the injured person is normally put into the recovery position.

Placed on the side, tilting the head back and ensuring that there are no blockages in the mouth. To free any such blockages, the back can be slapped or the chest compressed, allowing anything to be spat out. Now that the airway is free, check for B, or breathing.

If breathing is not happening or is irregular, the first aider may have to assist with what is technically known as cardiopulmonary resuscitation, or more commonly, CPR. This involves breathing for the patient through mouth-to-mouth contact, while periodically massaging the heart through compressions to the chest. This combination allows blood and oxygen to flow around the body, keeping the patient alive, hopefully until medics, such as doctors, advanced first aiders or ambulance staff arrive.

Before you hear the rest of the talk, you have some time to look at questions 18 to 20. Now listen and answer questions 18 to 20. Now it's certainly good to have knowledge of emergency first aid, but, obviously, the best situation is simply not to have accidents occur in the first place.

For that, you need to be aware of safety issues, but just saying, be aware, does not usually achieve much. It is more important to have an appointed person whose job is to ensure awareness and work safety. Safety inspections would obviously be part of their job, whereby they can make sure, for example, that the first aid boxes are fully equipped.

Another idea is to put posters on the walls, but, interestingly, research has proven that these tend to be ignored, becoming just part of the wallpaper, seen but not put into practice. It is much better if everyone is just instilled to not be reckless, that is, to not rush into situations without thinking about the possibility of accidents. And instilling this mindset is part of the job of the safety officer.

Some other suggestions are ongoing first aid training and no accident reward or star systems. These have had some success, but nothing beats a regular meeting, say once a month, in which the subject of safety is brought to the attention of everyone, and any outstanding issues related to this are thoroughly discussed. That is the end of section 2. You now have half a minute to check your answers.

Now turn to section 3.
        </div>
        <div data-part="3"><strong>SECTION 3</strong>

You will hear two students, Frank and Nicole, discussing their research on university waste. First, you have some time to look at questions 21 to 25. Now listen carefully and answer questions 21 to 25.

Hi, Nicole. As you know, we've got to decide on the best ways this university can reduce its waste. You inspected the Eastern campus and I did the Western buildings.

Did you do all the interviews as well? Yes, I interviewed all the staff who made some good observations and I interviewed some of the students. The students said little that was interesting. They don't seem to care that much.

It was the cleaners, surprisingly, who revealed the most relevant facts. That's not surprising to me. They empty all the bins so they see the waste first hand, whereas the staff just throw things away without thinking.

What item was most commonly disposed of? Well, it really depended on where I interviewed. In the cafeteria precinct, obviously paper plates and cups were thrown away all over the place. There was almost no attempt at recycling.

However, across the university in general, it was paper copying that filled up most bins, far more than plastic or other forms of waste. Do people care about this then? Well, some do, if you can believe them. I must have interviewed about 30% of customers in the cafeteria and the results were mixed.

Out of all the people I interviewed, well over half, maybe about 55% of them were quite honest about it, telling me that they had little concern. The other fraction, 45%, were more troubled. Yes, but do they do anything about it? Surprisingly, quite a significant percentage do do something, even if they aren't particularly concerned.

I mean, small things. About 10% bring their own cups to the cafeteria, for example, and at least one third said they use recycling bins. So, in total, it's an equal split between those who do something or those who don't.

So why do so many people remain inactive, particularly over an issue they should care about more? I think they do care, and many of them are prepared to do something. Obviously, there's an element of laziness, but I'd say that it's relatively small. If they knew what to do, and if stringent systems existed, or if the importance of this was made clearer to them, I'm sure you'd see a much larger percentage of people actively working towards helping our environment.

Well, there's cause for optimism, at least. Before you hear the rest of the conversation, you have some time to look at questions 26 to 30. Now listen and answer questions 26 to 30.

Clearly, then, there's a significant waste of paper here at this university, so I've worked out one practical suggestion which could help reduce it, specifically, the waste from the excess photocopying. Let me hear it, then. Ah, obviously, for a start, we've got to ensure that people, including the staff, without exception, copy both sides of a page.

We can't tolerate single-sided copying. It's just far too wasteful. Absolutely.

Just more trees being chopped down. But as people are doing copying, there may be adjustments and practice copying, producing single-sided copies or blank pages not wanted and not intended for use. These need to be deposited into a tray for intended recycling, you know, for re-copying onto the blank side of the page.

But people don't usually do that. I'm afraid it's just human nature. No matter how unimportant the copying is, they prefer to use fresh paper.

Yeah, I agree with you, which is why you need to display these papers right in front of everyone with a clear sign, please reuse, to make it easy for them to do so. They still won't do it. I know.

That's why you take some of these papers and regularly stack them inside the copier in a special tray once a day, say in the morning. Well, that's getting better, making it easier for them to use the paper. But still, I'm afraid many won't.

That's why you allow everyone to select this tray when copying. You distribute numbers or codes to every person, giving them special access to this recycling tray. Every time they use papers from this, it's tallied up to their account.

I know I'm sounding a bit negative or even cynical here, but why should they bother using that tray? Because the person who does the most copying from this recycling tray gets, say, a cinema pass or lottery ticket or some other sort of reward. Oh, right. Now that's a system which might just work.

Let's trial it in the office and see what happens. That is the end of section 3. You now have half a minute to check your answers. Now turn to section 4.
                </div>
        <div data-part="4"><strong>SECTION 4</strong>

You will hear an introduction of the exhibition named Two Centuries of the Bike.

First, you have some time to look at questions 31 to 40. Now listen carefully and answer questions 31 to 40. Good afternoon, ladies and gentlemen.

I'd like to take this opportunity to welcome you to our exhibition, Two Centuries of the Bike. Let's stroll around the exhibition, shall we? Although there were a few early efforts back in the 1700s, you didn't really see many bikes till, say, the 1830s in England. Bikes were a response to the rapid growth of cities early in the 19th century.

Cities like London were getting too big to walk across. The early bike let people travel with less effort than walking. Plus, a bike was a lot cheaper than a horse.

Think of it. No one invited a bike for, what, 5,000 years of human history. Why did people do it then? Probably because this was the start of the machine age.

People wanted machines to do all the work. There were some drawbacks, however. For one thing, there were no pedals.

You simply pushed yourself along using your feet, kind of like today's skateboard. That meant you went fairly slow, and uphill you actually worked harder, pushing that two-wheeler. Plus, the wheels were made of wood covered with metal, as you can see from this model.

So the downside was that the ride was quite uncomfortable on most roads. Only a few gadget lovers had or used them. By the 1860s, though, improvements were being made.

As you can see from this specimen, metal frames had become the rule. They're more durable than wood, and they don't warp in the rain. The biggest improvement, however, was the development of the chain and sprocket system.

They're connected. This meant you did not push the bike. You used pedals, just like today.

You had to try harder to balance, so it took some practice to figure out how to use the pedals. But it made the ride so much easier. As a result, the good thing was that you could ride a lot more smoothly, and with very little effort.

By the 1880s, another big change was the use of rubber wheels. These became pretty common at that time. Though the first ones were solid rubber, the ride was a good deal more comfortable than the old iron and wood system.

This is a big consideration, because the faster you go, the more you feel every bump. Air-filled tyres, pneumatic tyres, didn't really come into use until around the year 1900, as you can see from this exhibition over here. That made the ride even more comfortable.

So by 1890 or so, people were going a lot faster and a lot more smoothly. There was one problem when you were going quickly and comfortably. Oh no, how do I stop? Yes, we all laugh now, but for a long time, the only way to stop was to drag your feet.

That didn't work very well, and it would be dangerous if you were going fast. In the crowded cities of those years, New York, Chicago and so on, you'd get killed if you couldn't stop for, say, a streetcar. Plus, look at this bike.

The front wheel is nearly a metre and two-thirds tall. They made them that way so you could see over people in wagons, but you couldn't drag your feet. This model is called a velocipede, a speed pedal.

Another characteristic of the bike in this period is that it has two equal-sized wheels, which signalled a big change in bikes. For with the velocipede, brakes appeared. If you wanted to stop, you just pushed the pedal backwards.

Doing that stopped the back wheel of the bike. This technique worked a lot better than dragging your feet or jumping off the high seat there. This meant that bikes became a great deal safer.

It would have been safer if people wore helmets, but the first bicycle helmet wasn't invented until years later, and even then, it was little more than a leather ball cap. It really wasn't until the 1970s that the bike helmet was modified to provide some real protection. Before continuing on to look at developments since the 1890s, let's say a word more about safety.

Everyone knows if you're going downhill, you can get going dangerously fast. To go more than 100km an hour isn't all that difficult, but even on level ground, it's easy to go too quickly. On a city street, today's bicycles can be ridden at a speed of over 40mph over a short distance.

That's about 64km an hour. Remember, you're on a bike, not in a car. There's nothing to protect you.

People are killed in single bicycle accidents every day just from hitting the road. A good rule to remember is, if you're going faster than the cars, slow down, and please wear a helmet. Nearly one quarter of the epilepsy cases come from head injuries in accidents on bikes and motorcycles.

I don't mean to scare you, but safety is everyone's business. What? Now that's a good question. Why are today's bikes so much faster? Well, it's not just that today's athletes are faster.

The answer is partly mechanical. If you look closely here at the back wheel, you'll see a number of gears. Changing gears is what makes those fast speeds possible.

You can shift gears depending on the terrain and how hard you wish to pedal. So you can put it on a higher gear for downhill and a lower gear for uphill travel to make it easier to climb that slope. You'll notice this gear-shifting mechanism is attached to the back wheel.

And when the rider shifts on the handlebar gear shifter, the chain moves to the appropriate sprocket. And speaking of changing gears, let's look over here at our Tour de France exhibit. That is the end of section four.

You now have half a minute to check your answers. That is the end of the listening test. In the IELTS test, you will now have ten minutes to transfer your answers to an answer sheet.
        </div>
    </div>

    <!-- Answer Key -->
    <div id="answer-key" style="display:none;">
        <h3>Correct Answers:</h3>
        <p><strong>Part 1 (Questions 1-10):</strong></p>
        <p>1. July<br>2. 3/three days<br>3. test driving<br>4. camera<br>5. 110<br>6. Edgeworth<br>7. Summer<br>8. city centre/ center<br>9. directions<br>10. enquiring online/online</p>
        
        <p><strong>Part 2 (Questions 11-20):</strong></p>
        <p>11. B<br>12. A<br>13. B<br>14. C<br>15. A<br>16. F<br>17. H<br>18. B<br>19. D<br>20. C</p>
        
        <p><strong>Part 3 (Questions 21-30):</strong></p>
        <p>21. A<br>22. B<br>23. F<br>24. G<br>25. D<br>26. A<br>27. C<br>28-30. B, E, F</p>
        
        <p><strong>Part 4 (Questions 31-40):</strong></p>
        <p>31-32. C, D<br>33. parents<br>34. versions<br>35. country<br>36. transport<br>37. social<br>38. funding<br>39. competitions<br>40. professional</p>
    </div>

    <audio id="global-audio-player" class="hidden"></audio>

    <!-- Navigation Arrows -->
    <div class="nav-arrows">
        <button class="nav-arrow" onclick="previousPart()" id="prevBtn">‹</button>
        <button class="nav-arrow" onclick="nextPart()" id="nextBtn">›</button>
    </div>

    <!-- Bottom Navigation -->
    <nav class="nav-row perScorableItem" aria-label="Questions">
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(1)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">1</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 10</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(1)"><span class="sr-only">Question 1</span><span aria-hidden="true">1</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(2)"><span class="sr-only">Question 2</span><span aria-hidden="true">2</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(3)"><span class="sr-only">Question 3</span><span aria-hidden="true">3</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(4)"><span class="sr-only">Question 4</span><span aria-hidden="true">4</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(5)"><span class="sr-only">Question 5</span><span aria-hidden="true">5</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(6)"><span class="sr-only">Question 6</span><span aria-hidden="true">6</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(7)"><span class="sr-only">Question 7</span><span aria-hidden="true">7</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(8)"><span class="sr-only">Question 8</span><span aria-hidden="true">8</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(9)"><span class="sr-only">Question 9</span><span aria-hidden="true">9</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(10)"><span class="sr-only">Question 10</span><span aria-hidden="true">10</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 selected multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(2)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">2</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 10</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(11)"><span class="sr-only">Question 11</span><span aria-hidden="true">11</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(12)">
                    <span class="sr-only">Question 12</span>
                    <span aria-hidden="true">12</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(13)">
                    <span class="sr-only">Question 13</span>
                    <span aria-hidden="true">13</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(14)">
                    <span class="sr-only">Question 14</span>
                    <span aria-hidden="true">14</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(15)">
                    <span class="sr-only">Question 15</span>
                    <span aria-hidden="true">15</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(16)">
                    <span class="sr-only">Question 16</span>
                    <span aria-hidden="true">16</span>
                </button>
                <button class="subQuestion active scorable-item" onclick="goToQuestion(17)">
                    <span class="sr-only">Question 17</span>
                    <span aria-hidden="true">17</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(18)">
                    <span class="sr-only">Question 18</span>
                    <span aria-hidden="true">18</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(19)">
                    <span class="sr-only">Question 19</span>
                    <span aria-hidden="true">19</span>
                </button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(20)">
                    <span class="sr-only">Question 20</span>
                    <span aria-hidden="true">20</span>
                </button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(3)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">3</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 10</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(21)"><span class="sr-only">Question 21</span><span aria-hidden="true">21</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(22)"><span class="sr-only">Question 22</span><span aria-hidden="true">22</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(23)"><span class="sr-only">Question 23</span><span aria-hidden="true">23</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(24)"><span class="sr-only">Question 24</span><span aria-hidden="true">24</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(25)"><span class="sr-only">Question 25</span><span aria-hidden="true">25</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(26)"><span class="sr-only">Question 26</span><span aria-hidden="true">26</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(27)"><span class="sr-only">Question 27</span><span aria-hidden="true">27</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(28)"><span class="sr-only">Question 28</span><span aria-hidden="true">28</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(29)"><span class="sr-only">Question 29</span><span aria-hidden="true">29</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(30)"><span class="sr-only">Question 30</span><span aria-hidden="true">30</span></button>
            </div>
        </div>
        
        <div class="footer__questionWrapper___1tZ46 multiple" role="tablist">
            <button role="tab" class="footer__questionNo___3WNct" onclick="switchToPart(4)">
                <span>
                    <span aria-hidden="true" class="section-prefix">Part </span>
                    <span class="sectionNr" aria-hidden="true">4</span>
                    <span class="attemptedCount" aria-hidden="true">0 of 10</span>
                </span>
            </button>
            <div class="footer__subquestionWrapper___9GgoP">
                <button class="subQuestion scorable-item" onclick="goToQuestion(31)"><span class="sr-only">Question 31</span><span aria-hidden="true">31</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(32)"><span class="sr-only">Question 32</span><span aria-hidden="true">32</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(33)"><span class="sr-only">Question 33</span><span aria-hidden="true">33</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(34)"><span class="sr-only">Question 34</span><span aria-hidden="true">34</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(35)"><span class="sr-only">Question 35</span><span aria-hidden="true">35</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(36)"><span class="sr-only">Question 36</span><span aria-hidden="true">36</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(37)"><span class="sr-only">Question 37</span><span aria-hidden="true">37</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(38)"><span class="sr-only">Question 38</span><span aria-hidden="true">38</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(39)"><span class="sr-only">Question 39</span><span aria-hidden="true">39</span></button>
                <button class="subQuestion scorable-item" onclick="goToQuestion(40)"><span class="sr-only">Question 40</span><span aria-hidden="true">40</span></button>
            </div>
        </div>
        
        <button id="deliver-button" aria-label="Review your answers" class="footer__deliverButton___3FM07">
            <i class="fa fa fa-check" aria-hidden="true"></i>
            <span>Check Answers</span>
        </button>
    </nav>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu">
        <div class="context-menu-item" id="highlight-item" onclick="highlightText()">
            <span class="context-menu-icon">
                <svg viewBox="0 0 24 24" fill="black"><path d="M15.24 12.32L12.28 9.36l-1.04 1.04-1.04-1.04-1.04 1.04-1.04-1.04-1.04 1.04-1.04-1.04-3.12 3.12c-.59.58-1.54.58-2.12 0l-1.04-1.04c-.58-.59-.58-1.54 0-2.12L7.88.88c.59-.58 1.54-.58 2.12 0l1.04 1.04 1.04-1.04 1.04 1.04 1.04-1.04 1.04 1.04 1.04-1.04 3.12 3.12c.58.59.58 1.54 0 2.12l-1.04 1.04c-.58.59-1.54.59-2.12 0zM12 15l-3 3-7-7 3-3 7 7zm-9-5l-2.29 2.29c-.39.39-.39 1.02 0 1.41l8.29 8.29c.39.39 1.02.39 1.41 0L22.7 8.41c.39-.39.39-1.02 0-1.41L14.42.29c-.39-.39-1.02-.39-1.41 0L3 10z"/></svg>
            </span>
            <span>Highlight</span>
        </div>
        <div class="context-menu-item" id="comment-item" onclick="addComment()">
            <span class="context-menu-icon">
                <svg viewBox="0 0 24 24" fill="black"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 12H5.17L4 15.17V4h16v10z"/></svg>
            </span>
            <span>Comment</span>
        </div>
        <div class="context-menu-item" id="clear-item" onclick="clearHighlight()" style="display:none;">
            <span class="context-menu-icon">
                <svg viewBox="0 0 24 24" fill="black"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
            </span>
            <span>Clear</span>
        </div>
        <div class="context-menu-item" onclick="clearAllHighlights()">
            <span class="context-menu-icon">
                <svg viewBox="0 0 24 24" fill="black"><path d="M16 9h-2.29l3-3-1.42-1.42-3 3V5h-2v2.29l-3-3-1.42 1.42 3 3H5v2h2.29l-3 3 1.42 1.42 3-3V17h2v-2.29l3 3 1.42-1.42-3-3H17V9h-2zm-4 4h-2v-2h2v2z"/></svg>
            </span>
            <span>Clear All</span>
        </div>
    </div>

    <!-- Mobile highlight/comment toolbar -->
    <div id="mobile-selection-menu" class="mobile-selection-menu hidden">
        <button onclick="highlightText()">Highlight</button>
        <button onclick="addComment()">Comment</button>
    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Your Results</h2>
                <button id="modal-close-button" class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p id="score-summary"></p>
                <div id="result-details"></div>
            </div>
        </div>
    </div>

    <script>
        let currentPart = 1;
        let currentQuestion = 1;
        let selectedText = '';
        let selectedRange = null;
        let draggedElement = null;
        let testStarted = false;
        let timeInSeconds = 3600;
        let isHovering = false;
        let timerInterval;
        let contextElement = null;

        function updateAnsweredIndicators() {
            for (let qNum = 1; qNum <= 40; qNum++) {
                const btn = document.querySelector(`.subQuestion[onclick="goToQuestion(${qNum})"]`);
                if (!btn) continue;

                // Do not change style if it's already marked correct or incorrect
                if (btn.classList.contains('correct') || btn.classList.contains('incorrect')) {
                    continue;
                }

                let isAnswered = false;
                const textInput = document.getElementById(`q${qNum}`);
                const selectInput = document.getElementById(`q${qNum}`);
                const radioInput = document.querySelector(`input[name="q${qNum}"]:checked`);
                const dropZone = document.querySelector(`.drop-zone[data-question-id="${qNum}"]`);
                const clickableCell = document.querySelector(`.clickable-cell[data-question="${qNum}"].selected`);

                // Check for checkbox questions with multiple answer requirements
                if (qNum === 18) {
                    const checkboxes = document.querySelectorAll('input[name="q18-20"]:checked');
                    if (checkboxes.length >= 1) { isAnswered = true; }
                } else if (qNum === 19) {
                    const checkboxes = document.querySelectorAll('input[name="q18-20"]:checked');
                    if (checkboxes.length >= 2) { isAnswered = true; }
                } else if (qNum === 20) {
                    const checkboxes = document.querySelectorAll('input[name="q18-20"]:checked');
                    if (checkboxes.length >= 3) { isAnswered = true; }
                } else if (qNum === 38) {
                    const checkboxes = document.querySelectorAll('input[name="q38-40"]:checked');
                    if (checkboxes.length >= 1) { isAnswered = true; }
                } else if (qNum === 39) {
                    const checkboxes = document.querySelectorAll('input[name="q38-40"]:checked');
                    if (checkboxes.length >= 2) { isAnswered = true; }
                } else if (qNum === 40) {
                    const checkboxes = document.querySelectorAll('input[name="q38-40"]:checked');
                    if (checkboxes.length >= 3) { isAnswered = true; }
                } else if (selectInput && selectInput.tagName === 'SELECT' && selectInput.value && selectInput.value !== '') {
                    isAnswered = true;
                } else if (textInput && typeof textInput.value === 'string' && textInput.value.trim() !== '') {
                    isAnswered = true;
                } else if (radioInput) {
                    isAnswered = true;
                    if (qNum >= 17 && qNum <= 20) {
                        console.log(`Question ${qNum} radio detected as answered: ${radioInput.value}`);
                    }
                } else if (dropZone && dropZone.querySelector('.drag-item')) {
                    isAnswered = true;
                } else if (clickableCell) {
                    isAnswered = true;
                    if (qNum >= 13 && qNum <= 16 || qNum >= 25 && qNum <= 30) {
                        console.log(`Question ${qNum} clickable cell detected as answered: ${clickableCell.getAttribute('data-value')}`);
                        console.log(`Clickable cell element:`, clickableCell);
                    }
                }

                if (isAnswered) {
                    btn.classList.add('answered');
                } else {
                    btn.classList.remove('answered');
                }
            }
            // Keep attempted count in sync with latest interactions
            updateAttemptedCount(currentPart);
        }

        const audioPlayer = document.getElementById('global-audio-player');
        const timerContainer = document.querySelector('.timer-container');
        const timerDisplay = document.querySelector('.timer-display');
        const volumeSlider = document.getElementById('new-volume-slider');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const progressBar = document.getElementById('progress-bar');
        const currentTimeEl = document.getElementById('current-time');
        const totalDurationEl = document.getElementById('total-duration');
        const speedBtn = document.getElementById('speed-btn');
        const speedOptions = document.getElementById('speed-options');
        const volumeBtn = document.getElementById('volume-btn');

        const audioSource = 'https://ia801002.us.archive.org/2/items/mix-25m-12s-audio-joiner.com-copy-copy-copy-copy-copy-copy-copy-copy-copy-copy-c/mix_25m12s%20%28audio-joiner.com%29%20-%20CopyCopyCopyCopyCopyCopyCopyCopyCopyCopyCopyCopyCopyCopyCopy.mp3';
        audioPlayer.src = audioSource;

        const correctAnswers = {
            /* --- Part 1 --- */
            'q1': ['94635550'],
            'q2': ['Clark House'],
            'q3': ['University Drive'],
            'q4': ['Monday'],
            'q5': ['Thursday'],
            'q6': ['a month', 'one month', '1 month'],
            'q7': 'A',
            'q8': 'C',
            'q9': 'B',
            'q10': 'C',

            /* --- Part 2 --- */
            'q11': 'steps',
            'q12': 'danger',
            'q13': 'respond',
            'q14': 'unconscious',
            'q15': 'blockages',
            'q16': 'irregular',
            'q17': 'medics',
            'q18-20': ['C', 'D', 'F'],

            /* --- Part 3 --- */
            'q21': 'C',
            'q22': 'A',
            'q23': 'B',
            'q24': 'C',
            'q25': 'C',
            'q26': 'ensure',
            'q27': 'deposited',
            'q28': 'display',
            'q29': 'distribute',
            'q30': 'reward',

            /* --- Part 4 --- */
            'q31': 'less effort',
            'q32': 'uncomfortable',
            'q33': '1860s',
            'q34': 'connected',
            'q35': 'more smoothly',
            'q36': 'rubber wheels',
            'q37': 'safer',
            'q38-40': ['C', 'D', 'F']
        };

        const questionTypes = {
            'q1': 'text', 'q2': 'text', 'q3': 'text', 'q4': 'text', 'q5': 'text',
            'q6': 'text', 'q7': 'select', 'q8': 'select', 'q9': 'select', 'q10': 'select',
            'q11': 'text', 'q12': 'text', 'q13': 'text', 'q14': 'text', 'q15': 'text', 'q16': 'text', 'q17': 'text',
            'q18-20': 'checkbox',
            'q21': 'mcq', 'q22': 'mcq', 'q23': 'mcq', 'q24': 'mcq', 'q25': 'mcq', 'q26': 'text', 'q27': 'text', 'q28': 'text', 'q29': 'text', 'q30': 'text',
            'q31': 'text', 'q32': 'text', 'q33': 'text', 'q34': 'text', 'q35': 'text', 'q36': 'text', 'q37': 'text',
            'q38-40': 'checkbox'
        };

                    function setupCheckboxLimits() {
                const groupsWithLimits = [
                    { name: 'q18-20', max: 3 }, // Questions 18-20: choose THREE
                    { name: 'q38-40', max: 3 }, // Questions 38-40: choose THREE
                ];

            groupsWithLimits.forEach(({ name, max }) => {
                const checkboxes = Array.from(document.querySelectorAll(`input[type="checkbox"][name="${name}"]`));
                if (checkboxes.length === 0) return;

                const applyLimitState = () => {
                    const checkedCount = checkboxes.filter(c => c.checked).length;
                    if (checkedCount >= max) {
                        // Disable all remaining unchecked options when limit reached
                        checkboxes.forEach(c => { if (!c.checked) c.disabled = true; });
                    } else {
                        // Re-enable options when below limit
                        checkboxes.forEach(c => { c.disabled = false; });
                    }
                    updateAnsweredIndicators();
                };

                checkboxes.forEach(cb => {
                    cb.addEventListener('change', applyLimitState);
                });

                // Initialize on load
                applyLimitState();
            });
        }

        // Ensure checkbox limits are applied once the DOM is ready
        document.addEventListener('DOMContentLoaded', setupCheckboxLimits);

        // Test function to verify clickable cells are working
        function testClickableCells() {
            console.log('Testing clickable cells...');
            const cells = document.querySelectorAll('.clickable-cell');
            console.log(`Found ${cells.length} clickable cells`);
            cells.forEach((cell, index) => {
                const question = cell.getAttribute('data-question');
                const value = cell.getAttribute('data-value');
                const onclick = cell.getAttribute('onclick');
                console.log(`Cell ${index}: question=${question}, value=${value}, onclick=${onclick}`);
            });
        }
        
        function selectCell(cell, questionNumber, value) {
            try {
                console.log(`selectCell called: question ${questionNumber}, value ${value}`);
                console.log('Cell element:', cell);
                console.log('Cell classes:', cell.className);
                console.log('Cell data-question:', cell.getAttribute('data-question'));
                console.log('Cell data-value:', cell.getAttribute('data-value'));
                
                // Remove previous selection for this question
                const row = cell.closest('tr');
                if (!row) {
                    console.error('Could not find row for cell');
                    return;
                }
                
                const cells = row.querySelectorAll('.clickable-cell');
                console.log(`Found ${cells.length} clickable cells in row`);
                cells.forEach(c => {
                    c.classList.remove('selected');
                    console.log(`Removed 'selected' class from cell with value: ${c.getAttribute('data-value')}`);
                });
                
                // Select the clicked cell
                cell.classList.add('selected');
                console.log(`Added 'selected' class to cell with value: ${value}`);
                console.log('Cell classes after selection:', cell.className);
                
                // Store the answer in the hidden input
                const hiddenInput = document.getElementById(`q${questionNumber}`);
                if (hiddenInput) {
                    hiddenInput.value = value;
                    console.log(`Hidden input q${questionNumber} value set to: ${value}`);
                } else {
                    console.error(`Hidden input q${questionNumber} not found`);
                }

                // Update answered indicators
                updateAnsweredIndicators();
                
                // Force a visual update
                cell.style.display = 'none';
                cell.offsetHeight; // Force reflow
                cell.style.display = '';
                
            } catch (error) {
                console.error('Error in selectCell:', error);
            }
        }

        function switchToPart(partNumber, andPlay = false) {
            if (currentPart !== partNumber) {
                const firstQuestionOfPart = (partNumber - 1) * 10 + 1;
                currentQuestion = firstQuestionOfPart;
            }
            
            currentPart = partNumber;

            updateNavigation();
            document.querySelectorAll('.question-part').forEach(part => part.classList.add('hidden'));
            const partToShow = document.getElementById(`part-${partNumber}`);
            if (partToShow) {
                partToShow.classList.remove('hidden');
            }

            if (document.querySelector('.main-container.results-mode')) {
                const transcriptionSource = document.querySelector(`#transcription-data [data-part="${partNumber}"]`);
                const transcriptionTarget = document.getElementById('transcription-text');
                if (transcriptionSource && transcriptionTarget) {
                    transcriptionTarget.innerHTML = transcriptionSource.innerHTML;
                }
            }

            updateNavigation();
        }

        function updateNavigation() {
            document.querySelectorAll('.footer__questionWrapper___1tZ46').forEach((wrapper, index) => {
                wrapper.classList.remove('selected');
                updateAttemptedCount(index + 1);
            });
            const currentWrapper = document.querySelectorAll('.footer__questionWrapper___1tZ46')[currentPart - 1];
            if (currentWrapper) {
                currentWrapper.classList.add('selected');
            }
            document.getElementById('prevBtn').disabled = currentQuestion === 1;
            document.getElementById('nextBtn').disabled = currentQuestion === 40;
        }

        function goToQuestion(questionNumber) {
            currentQuestion = questionNumber;
            let partNumber = 1;
            if (questionNumber > 10 && questionNumber <= 20) partNumber = 2;
            else if (questionNumber > 20 && questionNumber <= 30) partNumber = 3;
            else if (questionNumber > 30) partNumber = 4;
            if (currentPart !== partNumber) {
                switchToPart(partNumber);
            }
            document.querySelectorAll('.subQuestion').forEach(btn => btn.classList.remove('active'));
            const questionBtn = document.querySelector(`.subQuestion[onclick="goToQuestion(${questionNumber})"]`);
            if (questionBtn) questionBtn.classList.add('active');

            // Scroll to the question
            let questionElement;
            if (questionNumber >= 27 && questionNumber <= 28) {
               questionElement = document.querySelector('input[name="q27-28"]');
            } else if (questionNumber >= 29 && questionNumber <= 30) {
               questionElement = document.querySelector('input[name="q29-30"]');
            } else {
                questionElement = document.getElementById(`q${questionNumber}`) || // text inputs
                                document.querySelector(`[data-question-id="${questionNumber}"]`) || // drag-drop
                                document.querySelector(`input[name="q${questionNumber}"]`) || // radio buttons
                                document.querySelector(`.clickable-cell[data-question="${questionNumber}"]`); // clickable cells (27-30)
            }
            
            if (questionElement) {
                const questionContainer = questionElement.closest('.question');
                if(questionContainer) {
                    questionContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    questionContainer.classList.add('flash');
                    setTimeout(() => {
                        questionContainer.classList.remove('flash');
                    }, 1000);
                }
            }
            updateNavigation();
        }

        function nextPart() {
            if (currentQuestion < 40) {
                goToQuestion(currentQuestion + 1);
            }
        }

        function previousPart() {
            if (currentQuestion > 1) {
                goToQuestion(currentQuestion - 1);
            }
        }

        function highlightText() {
            if (!selectedRange || selectedRange.collapsed) {
                closeContextMenu();
                return;
            }
            
            try {
                // Check if selection spans multiple elements
                const startContainer = selectedRange.startContainer;
                const endContainer = selectedRange.endContainer;
                
                if (startContainer === endContainer && startContainer.nodeType === Node.TEXT_NODE) {
                    // Simple case: selection within a single text node
                    const span = document.createElement('span');
                    span.className = 'highlight';
                    selectedRange.surroundContents(span);
                } else {
                    // Complex case: selection spans multiple elements
                    // Handle partial text selections and complex DOM structures
                    
                    // First, handle partial text at the start
                    const startOffset = selectedRange.startOffset;
                    const endOffset = selectedRange.endOffset;
                    
                    if (startContainer.nodeType === Node.TEXT_NODE && startOffset > 0) {
                        // Split the start text node if selection starts in the middle
                        const startText = startContainer.textContent;
                        const beforeText = startText.substring(0, startOffset);
                        const selectedStartText = startText.substring(startOffset);
                        
                        const beforeNode = document.createTextNode(beforeText);
                        const selectedNode = document.createTextNode(selectedStartText);
                        
                        const parent = startContainer.parentNode;
                        parent.insertBefore(beforeNode, startContainer);
                        parent.insertBefore(selectedNode, startContainer);
                        parent.removeChild(startContainer);
                        
                        // Update the range to start from the new node
                        selectedRange.setStart(selectedNode, 0);
                    }
                    
                    if (endContainer.nodeType === Node.TEXT_NODE && endOffset < endContainer.textContent.length) {
                        // Split the end text node if selection ends in the middle
                        const endText = endContainer.textContent;
                        const selectedEndText = endText.substring(0, endOffset);
                        const afterText = endText.substring(endOffset);
                        
                        const selectedNode = document.createTextNode(selectedEndText);
                        const afterNode = document.createTextNode(afterText);
                        
                        const parent = endContainer.parentNode;
                        parent.insertBefore(selectedNode, endContainer);
                        parent.insertBefore(afterNode, endContainer);
                        parent.removeChild(endContainer);
                        
                        // Update the range to end at the new node
                        selectedRange.setEnd(selectedNode, selectedNode.textContent.length);
                    }
                    
                    // Now extract the contents and highlight all text nodes
                    const fragment = selectedRange.extractContents();
                    
                    // Create a tree walker to find all text nodes
                    const walker = document.createTreeWalker(
                        fragment,
                        NodeFilter.SHOW_TEXT,
                        {
                            acceptNode: function(node) {
                                // Accept text nodes that have content (not just whitespace)
                                return node.textContent.trim() ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;
                            }
                        },
                        false
                    );
                    
                    const textNodes = [];
                    let node;
                    while (node = walker.nextNode()) {
                        textNodes.push(node);
                    }
                    
                    // Wrap each text node in a highlight span
                    textNodes.forEach(textNode => {
                        const span = document.createElement('span');
                        span.className = 'highlight';
                        const parent = textNode.parentNode;
                        if (parent) {
                            parent.insertBefore(span, textNode);
                            span.appendChild(textNode);
                        }
                    });
                    
                    // Insert the highlighted fragment back
                    selectedRange.insertNode(fragment);
                }
            } catch(err) {
                console.warn('Primary highlighting failed, trying robust fallback:', err);
                
                // Robust fallback for complex selections
                try {
                    const selection = window.getSelection();
                    if (selection.rangeCount > 0) {
                        const range = selection.getRangeAt(0);
                        
                        // Get all nodes in the selection
                        const startContainer = range.startContainer;
                        const endContainer = range.endContainer;
                        const commonAncestor = range.commonAncestorContainer;
                        
                        // Create a temporary range to work with
                        const tempRange = document.createRange();
                        tempRange.selectNodeContents(commonAncestor);
                        
                        // Find the start and end positions
                        const startPos = range.startOffset;
                        const endPos = range.endOffset;
                        
                        // Extract and highlight the content
                        const contents = range.extractContents();
                        
                        // Recursively highlight all text content
                        function highlightAllText(node) {
                            if (node.nodeType === Node.TEXT_NODE) {
                                if (node.textContent.trim()) {
                                    const span = document.createElement('span');
                                    span.className = 'highlight';
                                    span.style.backgroundColor = '#ffff00';
                                    const parent = node.parentNode;
                                    if (parent) {
                                        parent.insertBefore(span, node);
                                        span.appendChild(node);
                                    }
                                }
                            } else if (node.nodeType === Node.ELEMENT_NODE) {
                                Array.from(node.childNodes).forEach(child => {
                                    highlightAllText(child);
                                });
                            }
                        }
                        
                        highlightAllText(contents);
                        range.insertNode(contents);
                    }
                } catch(e2) {
                    console.warn('Robust fallback failed, using final method:', e2);
                    // Final fallback - use execCommand
                    try {
                        document.execCommand('backColor', false, 'yellow');
                    } catch(e3) {
                        console.error('All highlighting methods failed:', e3);
                        // Show user feedback
                        alert('Highlighting failed for this selection. Please try selecting smaller portions of text.');
                    }
                }
            }
            
            window.getSelection().removeAllRanges();
            closeContextMenu();
        }

        function addComment() {
            const commentText = prompt('Enter your comment:');
            if (!commentText || !selectedRange || selectedRange.collapsed) {
                closeContextMenu();
                return;
            }
            try {
                const span = document.createElement('span');
                span.className = 'comment-highlight';
                const tooltip = document.createElement('span');
                tooltip.className = 'comment-tooltip';
                tooltip.textContent = commentText;
                span.appendChild(tooltip);
                selectedRange.surroundContents(span);
            }catch(err){
                console.warn('Complex selection – cannot comment');
            }
            window.getSelection().removeAllRanges();
            closeContextMenu();
        }

        function clearHighlight() {
           const elementToClear = contextElement;
           if (!elementToClear) {
               closeContextMenu();
               return;
           }
           const parent = elementToClear.parentNode;
           
           while (elementToClear.firstChild) {
               if (!elementToClear.firstChild.classList?.contains('comment-tooltip')) {
                   parent.insertBefore(elementToClear.firstChild, elementToClear);
               } else {
                   elementToClear.removeChild(elementToClear.firstChild);
               }
           }
           parent.removeChild(elementToClear);
           parent.normalize();
           closeContextMenu();
        }

        function clearAllHighlights() {
            document.querySelectorAll('.highlight, .comment-highlight').forEach(element => {
                const parent = element.parentNode;
                const fragment = document.createDocumentFragment();

                while (element.firstChild) {
                    if (element.firstChild.nodeType === 1 && element.firstChild.classList.contains('comment-tooltip')) {
                        element.removeChild(element.firstChild);
                    } else {
                        fragment.appendChild(element.firstChild);
                    }
                }
                parent.replaceChild(fragment, element);
            });
            closeContextMenu();
        }
        
        function closeContextMenu() {
            document.getElementById('contextMenu').style.display = 'none';
            contextElement = null;
        }

        function updateAttemptedCount(partNumber) {
            const partContainer = document.getElementById(`part-${partNumber}`);
            if (!partContainer) return;
            const inputs = partContainer.querySelectorAll('input.answer-input:not([disabled]):not([type="hidden"]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select');
            let answeredCount = 0;
            const answeredGroups = {};
            inputs.forEach(input => {
                if (input.type === 'radio' || input.type === 'checkbox') {
                    if (input.name === 'q18-20') {
                        const checkedCount = partContainer.querySelectorAll('input[name="q18-20"]:checked').length;
                        // Represent q18, q19, and q20 as three separate questions in the footer count
                        const keyFirst = 'q18-20-first';
                        const keySecond = 'q18-20-second';
                        const keyThird = 'q18-20-third';
                        if (checkedCount >= 1 && !answeredGroups[keyFirst]) {
                            answeredCount++;
                            answeredGroups[keyFirst] = true;
                        }
                        if (checkedCount >= 2 && !answeredGroups[keySecond]) {
                            answeredCount++;
                            answeredGroups[keySecond] = true;
                        }
                        if (checkedCount >= 3 && !answeredGroups[keyThird]) {
                            answeredCount++;
                            answeredGroups[keyThird] = true;
                        }
                    } else if (input.name === 'q38-40') {
                        const checkedCount = partContainer.querySelectorAll('input[name="q38-40"]:checked').length;
                        // Represent q38, q39, and q40 as three separate questions in the footer count
                        const keyFirst = 'q38-40-first';
                        const keySecond = 'q38-40-second';
                        const keyThird = 'q38-40-third';
                        if (checkedCount >= 1 && !answeredGroups[keyFirst]) {
                            answeredCount++;
                            answeredGroups[keyFirst] = true;
                        }
                        if (checkedCount >= 2 && !answeredGroups[keySecond]) {
                            answeredCount++;
                            answeredGroups[keySecond] = true;
                        }
                        if (checkedCount >= 3 && !answeredGroups[keyThird]) {
                            answeredCount++;
                            answeredGroups[keyThird] = true;
                        }
                    } else if (input.checked && !answeredGroups[input.name]) {
                        answeredCount++;
                        answeredGroups[input.name] = true;
                    }
                } else {
                    if (input.value.trim() !== '') answeredCount++;
                }
            });
            // Include drag/drop filled zones as answered
            const zones = partContainer.querySelectorAll('.drop-zone[data-question-id]');
            zones.forEach(zone => {
                if (zone.querySelector('.drag-item')) {
                    answeredCount++;
                }
            });
            
            // Include clickable cells as answered (only for questions that use clickable cells, not text inputs)
            const clickableCells = partContainer.querySelectorAll('.clickable-cell.selected');
            clickableCells.forEach(cell => {
                const questionNum = cell.getAttribute('data-question');
                if (questionNum && !answeredGroups[`clickable-${questionNum}`]) {
                    // Only count clickable cells if there's no corresponding text input for this question
                    const textInput = partContainer.querySelector(`#q${questionNum}`);
                    if (!textInput || textInput.type !== 'text') {
                        answeredCount++;
                        answeredGroups[`clickable-${questionNum}`] = true;
                    }
                }
            });
            
            // Include map questions (15-20) as answered if they have a selection
            for (let i = 15; i <= 20; i++) {
                const selectElement = partContainer.querySelector(`#q${i}`);
                if (selectElement && selectElement.value && selectElement.value !== '' && !answeredGroups[`map-${i}`]) {
                    answeredCount++;
                    answeredGroups[`map-${i}`] = true;
                }
            }
            const countDisplay = document.querySelector(`.footer__questionWrapper___1tZ46:nth-child(${partNumber}) .attemptedCount`);
            if (countDisplay) countDisplay.textContent = `${answeredCount} of 10`;
        }

        function checkAnswers() {
            let score = 0;
            let resultsData = [];
            document.querySelectorAll('.correct, .incorrect, .correct-answer-text, .correct-inline').forEach(el => {
                if (el.classList.contains('correct-answer-text') || el.classList.contains('correct-inline')) {
                    el.remove();
                } else {
                    el.classList.remove('correct', 'incorrect');
                }
            });
            
            Object.keys(correctAnswers).forEach(key => {
                const correctAnswer = correctAnswers[key];
                let userAnswer = '';
                let isCorrect = false;
                const questionType = questionTypes[key];
                
                // Handle different question types
                if (key.includes('-')) {
                    // Multi-question keys like 'q11-12', 'q13-14'
                    const [startQ, endQ] = key.split('-').map(q => parseInt(q.replace('q', '')));
                    
                    switch(questionType) {
                        case 'checkbox':
                            const checkedBoxes = document.querySelectorAll(`input[name="${key}"]:checked`);
                            const userAnswers = Array.from(checkedBoxes).map(cb => cb.value).sort();
                            userAnswer = userAnswers.join(', ');
                            const correctAnswersSorted = Array.isArray(correctAnswer) ? [...correctAnswer].sort() : [correctAnswer];
                            
                            // Count how many correct answers the user selected
                            const correctUserAnswers = userAnswers.filter(ans => correctAnswersSorted.includes(ans));
                            
                            // Additive-only scoring: 1 point per correct selected; no penalty for incorrect
                            const questionScore = correctUserAnswers.length;
                            score += questionScore;
                            
                            // Mark group as fully correct only if all correct options are selected and no extra are selected
                            isCorrect = (correctUserAnswers.length === correctAnswersSorted.length && userAnswers.length === correctAnswersSorted.length);
                            
                            // Mark individual checkboxes
                            checkedBoxes.forEach(cb => {
                                const label = cb.closest('label');
                                if (label) {
                                    if (correctAnswersSorted.includes(cb.value)) {
                                        label.classList.add('correct');
                                    } else {
                                        label.classList.add('incorrect');
                                    }
                                }
                            });
                            
                            // Mark correct answers that weren't selected
                            correctAnswersSorted.forEach(correctVal => {
                                const correctCheckbox = document.querySelector(`input[name="${key}"][value="${correctVal}"]`);
                                if (correctCheckbox && !correctCheckbox.checked) {
                                    const correctLabel = correctCheckbox.closest('label');
                                    if (correctLabel) {
                                        correctLabel.classList.add('correct');
                                    }
                                }
                            });
                            break;
                    }
                    
                    // Mark buttons for the question range
                    for (let qNum = startQ; qNum <= endQ; qNum++) {
                        const btn = document.querySelector(`.subQuestion[onclick="goToQuestion(${qNum})"]`);
                        if (btn) {
                            btn.classList.remove('answered');
                            btn.classList.add(isCorrect ? 'correct' : 'incorrect');
                        }
                    }
                    
                    resultsData.push({
                        question: `${startQ}-${endQ}`,
                        userAnswer: userAnswer || 'No Answer',
                        correctAnswer: Array.isArray(correctAnswer) ? correctAnswer.join(', ') : String(correctAnswer),
                        isCorrect: isCorrect
                    });
                    
                    // For checkbox questions in multi-question keys, score was already added in switch statement
                    // Don't add additional score here - return to next iteration of forEach
                    return;
                }
                
                   const qNum = parseInt(key.replace('q', ''));
                   const btn = document.querySelector(`.subQuestion[onclick="goToQuestion(${qNum})"]`);
                   const element = document.getElementById(key) || document.querySelector(`input[name="${key}"]`);

                   // Determine question type: prefer explicit mapping over DOM input type
                   if (!questionType) {
                       if (element?.type === 'radio') questionType = 'mcq';
                       else if (element?.type === 'text') questionType = 'text';
                       else if (element?.tagName === 'SELECT') questionType = 'select';
                   }
                   
                    switch (questionType) {
                       case 'text':
                           userAnswer = element.value.trim();
                           const acceptedAnswers = Array.isArray(correctAnswer) ? correctAnswer : [String(correctAnswer)];
                           isCorrect = acceptedAnswers.some(ans => ans.toLowerCase() === userAnswer.toLowerCase());
                           element.classList.add(isCorrect ? 'correct' : 'incorrect');
                           if (!isCorrect) {
                                const correctAnswerSpan = document.createElement('span');
                                correctAnswerSpan.className = 'correct-inline';
                                correctAnswerSpan.textContent = acceptedAnswers[0];
                                element.insertAdjacentElement('afterend', correctAnswerSpan);
                           }
                           break;
                        case 'select':
                            userAnswer = (element.value || '').trim();
                            isCorrect = userAnswer === correctAnswer;
                            element.classList.add(isCorrect ? 'correct' : 'incorrect');
                            if (!isCorrect) {
                                const correctAnswerSpan = document.createElement('span');
                                correctAnswerSpan.className = 'correct-inline';
                                correctAnswerSpan.textContent = String(correctAnswer);
                                element.insertAdjacentElement('afterend', correctAnswerSpan);
                            }
                            break;
                        case 'mcq':
                            // For map questions (15-20), use the select dropdown selection instead of radios
                            if (qNum >= 15 && qNum <= 20) {
                                const selectElement = document.getElementById(key);
                                if (selectElement) {
                                    userAnswer = (selectElement.value || '').trim();
                                    isCorrect = userAnswer === correctAnswer;
                                    selectElement.classList.add(isCorrect ? 'correct' : 'incorrect');
                                    if (!isCorrect) {
                                        const correctAnswerSpan = document.createElement('span');
                                        correctAnswerSpan.className = 'correct-inline';
                                        correctAnswerSpan.textContent = String(correctAnswer);
                                        selectElement.insertAdjacentElement('afterend', correctAnswerSpan);
                                    }
                                    break;
                                }
                            }

                            // Default MCQ grading via radio inputs
                            const radioChecked = document.querySelector(`input[name="${key}"]:checked`);
                            userAnswer = radioChecked ? radioChecked.value : 'No Answer';
                            isCorrect = userAnswer === correctAnswer;
                            const radios = document.querySelectorAll(`input[name="${key}"]`);
                            radios.forEach(radio => {
                                const label = radio.closest('label');
                                const wrapper = radio.closest('.multi-choice-option') || label;
                                if (radio.value === correctAnswer) {
                                    wrapper.classList.add('correct');
                                } else if (radio.checked) {
                                    wrapper.classList.add('incorrect');
                                }
                            });
                            break;
                        case 'dragdrop': {
                            const dz = document.querySelector(`.drop-zone[data-question-id="${qNum}"]`);
                            const dropped = dz ? dz.querySelector('.drag-item') : null;
                            // Prefer hidden input (kept in sync on drop), then dataset/attribute
                            const hiddenVal = element ? element.value.trim() : '';
                            if (hiddenVal) {
                                userAnswer = hiddenVal;
                            } else if (dropped) {
                                const dataLetter = dropped.getAttribute('data-letter') || dropped.dataset.letter;
                                userAnswer = (dataLetter && dataLetter.trim()) || dropped.textContent.trim();
                            } else {
                                userAnswer = '';
                            }
                            const accepted = Array.isArray(correctAnswer) ? correctAnswer.map(a=>String(a).toLowerCase()) : [String(correctAnswer).toLowerCase()];
                            isCorrect = userAnswer && accepted.includes(String(userAnswer).toLowerCase());
                            if (!isCorrect) {
                                const correctAnswerSpan = document.createElement('span');
                                correctAnswerSpan.className = 'correct-inline';
                                // show canonical uppercase answer for letters
                                const showVal = Array.isArray(correctAnswer) ? String(correctAnswer[0]) : String(correctAnswer);
                                correctAnswerSpan.textContent = showVal;
                                // Make sure it sits inline with the question row
                                correctAnswerSpan.style.display = 'inline-block';
                                correctAnswerSpan.style.marginLeft = '8px';
                                const anchor = dz || element; // prefer drop-zone, fallback to hidden input
                                if (anchor) {
                                    anchor.insertAdjacentElement('afterend', correctAnswerSpan);
                                }
                            }
                            break; }
                       case 'clickable':
                           console.log(`Checking clickable question ${qNum}, correct answer: ${correctAnswer}`);
                           const selectedCell = document.querySelector(`.clickable-cell[data-question="${qNum}"].selected`);
                           console.log(`Selected cell for question ${qNum}:`, selectedCell);
                           userAnswer = selectedCell ? selectedCell.getAttribute('data-value') : 'No Answer';
                           console.log(`User answer for question ${qNum}: ${userAnswer}`);
                           isCorrect = userAnswer === correctAnswer;
                           console.log(`Question ${qNum} is correct: ${isCorrect}`);
                           
                           // Mark cells as correct/incorrect
                           const allCells = document.querySelectorAll(`.clickable-cell[data-question="${qNum}"]`);
                           allCells.forEach(cell => {
                               if (cell.getAttribute('data-value') === correctAnswer) {
                                   cell.classList.add('correct');
                               } else if (cell.classList.contains('selected')) {
                                   cell.classList.add('incorrect');
                               }
                           });
                           break;
                       case 'checkbox':
                           const checkedBoxes = document.querySelectorAll(`input[name="${key}"]:checked`);
                           const userAnswers = Array.from(checkedBoxes).map(cb => cb.value).sort();
                           userAnswer = userAnswers.join(', ');
                           const correctAnswersSorted = Array.isArray(correctAnswer) ? correctAnswer.sort() : [correctAnswer];
                           
                           // Count how many correct answers the user selected
                           const correctUserAnswers = userAnswers.filter(ans => correctAnswersSorted.includes(ans));
                           
                           // Additive-only scoring: 1 point per correct selected; no penalty for incorrect
                           const questionScore = correctUserAnswers.length;
                           score += questionScore;
                           
                           // Mark group as fully correct only if all correct options are selected and no extra are selected
                           isCorrect = (correctUserAnswers.length === correctAnswersSorted.length && userAnswers.length === correctAnswersSorted.length);
                           
                           // Mark individual checkboxes
                           checkedBoxes.forEach(cb => {
                               const label = cb.closest('label');
                               if (label) {
                                   if (correctAnswersSorted.includes(cb.value)) {
                                       label.classList.add('correct');
                                   } else {
                                       label.classList.add('incorrect');
                                   }
                               }
                           });
                           
                           // Mark correct answers that weren't selected
                           correctAnswersSorted.forEach(correctVal => {
                               const correctCheckbox = document.querySelector(`input[name="${key}"][value="${correctVal}"]`);
                               if (correctCheckbox && !correctCheckbox.checked) {
                                   const correctLabel = correctCheckbox.closest('label');
                                   if (correctLabel) {
                                       correctLabel.classList.add('correct');
                                   }
                               }
                           });
                           break;
                   }

                   if (btn) {
                       btn.classList.remove('answered');
                       btn.classList.add(isCorrect ? 'correct' : 'incorrect');
                   }

                   resultsData.push({
                       question: qNum,
                       userAnswer: userAnswer || 'No Answer',
                       correctAnswer: Array.isArray(correctAnswer) ? correctAnswer.join(' / ') : String(correctAnswer),
                       isCorrect: isCorrect
                   });

                // For checkbox questions, score was already added in the switch statement
                // Only add score for non-checkbox questions
                if (questionType !== 'checkbox' && isCorrect) {
                   score++;
               }
            });

            const deliverButton = document.getElementById('deliver-button');
            const band = (function(raw){
                if(raw>=39) return 9;
                if(raw>=37) return 8.5;
                if(raw>=35) return 8;
                if(raw>=32) return 7.5;
                if(raw>=30) return 7;
                if(raw>=26) return 6.5;
                if(raw>=23) return 6;
                if(raw>=18) return 5.5;
                if(raw>=16) return 5;
                if(raw>=13) return 4.5;
                if(raw>=10) return 4;
                if(raw>=8)  return 3.5;
                if(raw>=6)  return 3;
                if(raw>=4)  return 2.5;
                if(raw>=2)  return 2;
                if(raw===1) return 1.5;
                return 0;
            })(score);

            // Disable all inputs after grading
            document.querySelectorAll('.answer-input, input[type="radio"], input[type="checkbox"]').forEach(input => {
                input.disabled = true;
            });
            document.querySelectorAll('.drag-item').forEach(item => {
                item.setAttribute('draggable', 'false');
                item.style.cursor = 'default';
            });
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('drag-over'); // Ensure no lingering hover styles
            });

            // Results mode layout with transcription
            document.querySelector('.main-container').classList.add('results-mode');
            switchToPart(currentPart); // Show the transcription for the current part

            // Populate modal content (but do not force-open yet)
            const modal = document.getElementById('result-modal');
            const scoreSummary = document.getElementById('score-summary');
            const resultDetails = document.getElementById('result-details');
            
            scoreSummary.textContent = `You scored ${score} out of 40 (Band ${band}).`;
            
            let tableHTML = '<table><thead><tr><th>Question</th><th>Your Answer</th><th>Correct Answer</th><th>Result</th></tr></thead><tbody>';
            resultsData.sort((a,b) => parseInt(a.question, 10) - parseInt(b.question, 10)).forEach(res => {
                tableHTML += `
                    <tr>
                        <td>${res.question}</td>
                        <td>${res.userAnswer}</td>
                        <td>${res.correctAnswer}</td>
                        <td class="${res.isCorrect ? 'result-correct' : 'result-incorrect'}">
                            ${res.isCorrect ? '✔ Correct' : '✖ Incorrect'}
                        </td>
                    </tr>
                `;
            });
            tableHTML += '</tbody></table>';
            // Controls: filter toggles and export
            const controls = document.createElement('div');
            controls.className = 'result-controls';
            controls.innerHTML = `
                <label><input type="checkbox" id="toggle-correct" checked> Show correct</label>
                <label><input type="checkbox" id="toggle-incorrect" checked> Show incorrect</label>
                <span class="spacer"></span>
                <button id="export-csv" class="btn-secondary">Export CSV</button>
            `;
            // Apply to modal
            resultDetails.innerHTML = '';
            resultDetails.appendChild(controls);
            const tableContainer = document.createElement('div');
            tableContainer.innerHTML = tableHTML;
            resultDetails.appendChild(tableContainer);
            
            // Wire up filters
            const toggleCorrect = controls.querySelector('#toggle-correct');
            const toggleIncorrect = controls.querySelector('#toggle-incorrect');
            function applyFilters(){
                tableContainer.querySelectorAll('tbody tr').forEach(row => {
                    const isCorrect = row.querySelector('td.result-correct') !== null;
                    const isIncorrect = row.querySelector('td.result-incorrect') !== null;
                    let visible = true;
                    if (isCorrect && !toggleCorrect.checked) visible = false;
                    if (isIncorrect && !toggleIncorrect.checked) visible = false;
                    row.style.display = visible ? '' : 'none';
                });
            }
            toggleCorrect.addEventListener('change', applyFilters);
            toggleIncorrect.addEventListener('change', applyFilters);
            applyFilters();
            
            // CSV export
            controls.querySelector('#export-csv').addEventListener('click', () => {
                const rows = [['Question','Your Answer','Correct Answer','Result']];
                tableContainer.querySelectorAll('tbody tr').forEach(tr => {
                    if (tr.style.display === 'none') return; // respect filters
                    const tds = tr.querySelectorAll('td');
                    const resultCell = tds[3];
                    const resultText = resultCell.classList.contains('result-correct') ? 'Correct' : 'Incorrect';
                    rows.push([tds[0].textContent.trim(), tds[1].textContent.trim(), tds[2].textContent.trim(), resultText]);
                });
                const csv = rows.map(r => r.map(v => '"' + v.replace(/"/g,'""') + '"').join(',')).join('\n');
                const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'listening_results.csv';
                a.click();
                URL.revokeObjectURL(url);
            });
            resultDetails.innerHTML = tableHTML;

            // Turn the deliver button into a green "My Results" button
            deliverButton.classList.add('success');
            deliverButton.innerHTML = '<span>My Results</span>';
            deliverButton.disabled = false;

            // Rebind click handler to open the results modal from now on
            const myResultsBtn = deliverButton.cloneNode(true);
            deliverButton.parentNode.replaceChild(myResultsBtn, deliverButton);
            myResultsBtn.addEventListener('click', () => {
                const modalEl = document.getElementById('result-modal');
                if (modalEl) modalEl.style.display = 'flex';
            });

            // Open the modal immediately after grading
            modal.style.display = 'flex';
        }
        
        function startTimer() {
            timerInterval = setInterval(() => {
                timeInSeconds--;
                const minutes = Math.floor(timeInSeconds / 60);
                const seconds = timeInSeconds % 60;
                timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                if (timeInSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = "Time's up!";
                    checkAnswers();
                }
            }, 1000);
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
        }

        // Event Listeners
        playPauseBtn.addEventListener('click', () => {
            if (!testStarted) {
                testStarted = true; // Timer removed, skip startTimer
                switchToPart(currentPart, true);
            } else {
                if (audioPlayer.paused) {
                    // If paused, ensure the audio source is for the current part
                    if (!audioPlayer.src.includes(audioSource)) {
                        audioPlayer.src = audioSource;
                    }
                    audioPlayer.play();
                } else {
                    audioPlayer.pause();
                }
            }
        });
        
        audioPlayer.addEventListener('play', () => {
            playPauseBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>`;
        });

        audioPlayer.addEventListener('pause', () => {
            playPauseBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>`;
        });

        audioPlayer.addEventListener('ended', () => {
            if (currentPart < 4) {
                switchToPart(currentPart + 1, true);
            }
        });

        audioPlayer.addEventListener('loadedmetadata', () => {
            progressBar.max = audioPlayer.duration;
            totalDurationEl.textContent = formatTime(audioPlayer.duration);
        });

        audioPlayer.addEventListener('timeupdate', () => {
            progressBar.value = audioPlayer.currentTime;
            currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
        });

        progressBar.addEventListener('input', () => {
            audioPlayer.currentTime = progressBar.value;
        });

        volumeSlider.addEventListener('input', (e) => audioPlayer.volume = e.target.value);

        speedBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            speedOptions.classList.toggle('hidden');
        });

        speedOptions.addEventListener('click', (e) => {
            if (e.target.dataset.speed) {
                const speed = parseFloat(e.target.dataset.speed);
                audioPlayer.playbackRate = speed;
                speedBtn.textContent = `${speed}x`;
                speedOptions.classList.add('hidden');
            }
        });
        
        document.addEventListener('click', () => {
            if (!speedOptions.classList.contains('hidden')) {
                speedOptions.classList.add('hidden');
            }
        });

        document.getElementById('deliver-button').addEventListener('click', checkAnswers);
        
        // ===== Drag & Drop handlers for Questions 17-20 =====
        (function initDragDrop(){
            // make items draggable with data transfer id
            function handleDragStart(e){
                const id = e.target.id;
                if (!id) {
                    // ensure each option has an id
                    const letter = e.target.getAttribute('data-letter') || e.target.getAttribute('data-value');
                    e.target.id = 'opt_' + letter;
                }
                e.dataTransfer.setData('text/plain', e.target.id);
            }
            function handleDragOver(e){
                e.preventDefault();
                const zone = e.currentTarget;
                zone.classList.add('drag-over');
            }
            function handleDragLeave(e){
                e.currentTarget.classList.remove('drag-over');
            }
            function placeItemInZone(itemEl, zone){
                // Only allow one item per zone
                const existing = zone.querySelector('.drag-item');
                if (existing){
                    // move existing back to options box
                    const partId = zone.closest('.question-part').id;
                    const bank = partId === 'part-2' ? document.getElementById('part2-options-box') : document.getElementById('part3-options-box');
                    if (bank) bank.appendChild(existing);
                }
                // ensure letter badge is visible along with text
                // keep full item so it remains draggable and shows its letter
                itemEl.classList.add('in-zone');
                zone.textContent = '';
                zone.appendChild(itemEl);
                // sync hidden input for this question
                const qid = zone.getAttribute('data-question-id') || zone.getAttribute('data-question');
                const hidden = document.getElementById('q' + qid);
                if (hidden){
                    const letter = itemEl.getAttribute('data-letter') || itemEl.getAttribute('data-value');
                    hidden.value = letter;
                }
                updateAnsweredIndicators();
            }
            function handleDrop(e){
                e.preventDefault();
                const zone = e.currentTarget;
                zone.classList.remove('drag-over');
                const id = e.dataTransfer.getData('text/plain');
                const itemEl = document.getElementById(id);
                if (!itemEl) return;
                placeItemInZone(itemEl, zone);
                const ph = zone.querySelector('.placeholder');
                if (ph) ph.style.display = 'none';
            }
            function handleBankDrop(e){
                e.preventDefault();
                const bank = e.currentTarget;
                const id = e.dataTransfer.getData('text/plain');
                const itemEl = document.getElementById(id);
                if (!itemEl) return;
                // If coming from a zone, clear that zone's hidden input
                const fromZone = itemEl.parentElement && itemEl.parentElement.classList.contains('drop-zone') ? itemEl.parentElement : null;
                if (fromZone){
                    const qid = fromZone.getAttribute('data-question-id') || fromZone.getAttribute('data-question');
                    const hidden = document.getElementById('q' + qid);
                    if (hidden) hidden.value = '';
                    // Restore the drop zone to show placeholder
                    fromZone.classList.remove('filled');
                    fromZone.innerHTML = '';
                    const placeholder = document.createElement('span');
                    placeholder.className = 'placeholder';
                    placeholder.innerHTML = '&nbsp;';
                    fromZone.appendChild(placeholder);
                }
                itemEl.classList.remove('in-zone');
                bank.appendChild(itemEl);
                updateAnsweredIndicators();
            }
            // Attach listeners for Part 2
            document.querySelectorAll('#part-2 .drag-item').forEach(el=>{
                el.addEventListener('dragstart', handleDragStart);
            });
            document.querySelectorAll('#part-2 .drop-zone').forEach(zone=>{
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });
            const bank2 = document.getElementById('part2-options-box');
            if (bank2){
                bank2.addEventListener('dragover', handleDragOver);
                bank2.addEventListener('dragleave', handleDragLeave);
                bank2.addEventListener('drop', handleBankDrop);
            }
            
            // Attach listeners for Part 3
            document.querySelectorAll('#part-3 .drag-item').forEach(el=>{
                el.addEventListener('dragstart', handleDragStart);
            });
            document.querySelectorAll('#part-3 .drop-zone').forEach(zone=>{
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });
            const bank3 = document.getElementById('part3-options-box');
            if (bank3){
                bank3.addEventListener('dragover', handleDragOver);
                bank3.addEventListener('dragleave', handleDragLeave);
                bank3.addEventListener('drop', handleBankDrop);
            }
        })();
        
        // Go To Question Widget Logic
        const gotoWidget = document.getElementById('goto-widget');
        const gotoInput = document.getElementById('goto-input');
        const gotoBtn = document.getElementById('goto-btn');

        document.addEventListener('keydown', (e) => {
            if (e.key >= '0' && e.key <= '9' && document.activeElement.tagName !== 'INPUT') {
                e.preventDefault();
                gotoWidget.classList.remove('hidden');
                gotoInput.focus();
                gotoInput.value = e.key;
            }
            if (e.key === 'Enter' && document.activeElement === gotoInput) {
                gotoBtn.click();
            }
            if (e.key === 'Escape') {
                gotoWidget.classList.add('hidden');
                gotoInput.value = '';
            }
        });

        if (gotoBtn) {
            gotoBtn.addEventListener('click', () => {
                const qNum = parseInt(gotoInput.value, 10);
                if (qNum >= 1 && qNum <= 40) {
                    goToQuestion(qNum);
                    gotoWidget.classList.add('hidden');
                    gotoInput.value = '';
                } else {
                    alert('Please enter a number between 1 and 40.');
                }
            });
        }

        // Add listener for the modal close button
        document.getElementById('modal-close-button').addEventListener('click', () => {
            document.getElementById('result-modal').style.display = 'none';
        });

        // === Tap-to-select & tap-to-drop for drag items (mobile support) ===
            document.body.addEventListener('click', function(e){
            const item = e.target.closest('.drag-item');
            if(item && item.getAttribute('draggable')){
                // Toggle selection
                document.querySelectorAll('.drag-item.selected').forEach(i=>i.classList.remove('selected'));
                item.classList.add('selected');
                draggedElement = item;
                return;
            }
            const dz = e.target.closest('.drop-zone');
            if(dz && draggedElement){
                // Skip if this is a Part 2 drop zone (let the Part 2 specific handler handle it)
                if (dz.closest('#part-2')) {
                    return;
                }
                // If already filled, move old back
                const container = dz.closest('.matching-container') || dz.closest('.matching-question-container') || document;
                const optionsList = container.querySelector('.matching-options-list') || document.querySelector('.matching-options-list');
                if(dz.children.length>0 && dz.firstElementChild!==draggedElement){
                    // restore original label (with letter) when returning to bank
                    const old = dz.firstElementChild;
                    if (old && old.dataset && old.dataset.fullLabel) {
                        old.textContent = old.dataset.fullLabel;
                    }
                    optionsList.appendChild(old);
                    // clear hidden value for the zone now emptied
                    const qIdOld = dz.getAttribute('data-question-id');
                    const hiddenOld = document.getElementById(`q${qIdOld}`);
                    if (hiddenOld) hiddenOld.value = '';
                    // Restore the drop zone to show placeholder
                    dz.classList.remove('filled');
                    dz.innerHTML = '';
                    const placeholder = document.createElement('span');
                    placeholder.className = 'placeholder';
                    placeholder.innerHTML = '&nbsp;';
                    dz.appendChild(placeholder);
                }
                // save full label before mutating
                if (!draggedElement.dataset.fullLabel) {
                    draggedElement.dataset.fullLabel = draggedElement.textContent.trim();
                }
                // show only the option text (strip leading "A. ", "B. ", etc.)
                const full = draggedElement.dataset.fullLabel;
                const letter = (full.match(/^\s*([A-G])\s*[\.)-]?/i) || [,''])[1].toUpperCase();
                const plain = full.replace(/^\s*[A-G]\s*[\.)-]?\s*/i, '');
                if (!draggedElement.dataset.letter && letter) {
                    draggedElement.dataset.letter = letter;
                }
                                    // Create a new element with the letter pill and plain text
                    const newElement = document.createElement('div');
                    newElement.className = 'drag-item';
                    newElement.setAttribute('draggable', 'true');
                    newElement.setAttribute('data-letter', letter);
                    newElement.setAttribute('data-value', letter);
                    newElement.setAttribute('data-fullLabel', full);
                    newElement.style.width = 'auto';
                    newElement.style.minWidth = 'fit-content';
                    
                    // Create the letter pill
                    const letterPill = document.createElement('span');
                    letterPill.className = 'drop-letter';
                    letterPill.textContent = letter;
                    
                    // Create the text span
                    const textSpan = document.createElement('span');
                    textSpan.textContent = plain;
                    textSpan.style.marginLeft = '8px';
                    textSpan.style.whiteSpace = 'nowrap';
                    
                    newElement.appendChild(letterPill);
                    newElement.appendChild(textSpan);
                    
                    // Replace the original element
                    draggedElement.parentNode.replaceChild(newElement, draggedElement);
                    draggedElement = newElement;
                dz.appendChild(draggedElement);
                draggedElement.classList.remove('selected');
                draggedElement=null;
                // style as filled pill and hide placeholder
                dz.classList.add('filled');
                const placeholder = dz.querySelector('.placeholder');
                if (placeholder) placeholder.style.display = 'none';
                // sync hidden input to the letter
                const qId = dz.getAttribute('data-question-id');
                const hiddenInput = document.getElementById(`q${qId}`);
                if (hiddenInput) hiddenInput.value = letter || '';
                updateAnsweredIndicators();
            }
        });

        // === Mobile highlight/comment toolbar ===
        const mobileToolbar = document.getElementById('mobile-selection-menu');
        function positionToolbar(){
            const sel = window.getSelection();
            if(sel.rangeCount===0 || sel.isCollapsed){
                mobileToolbar.classList.add('hidden');
                return;
            }
            const range = sel.getRangeAt(0);
            const rect = range.getBoundingClientRect();
            mobileToolbar.style.top = window.scrollY + rect.top - mobileToolbar.offsetHeight - 8 + 'px';
            mobileToolbar.style.left = window.scrollX + rect.left + 'px';
            mobileToolbar.classList.remove('hidden');
        }
        document.addEventListener('selectionchange', () => {
            const sel = window.getSelection();
            if(sel && sel.rangeCount>0 && !sel.isCollapsed){
                selectedRange = sel.getRangeAt(0);
                selectedText = sel.toString();
            }
            if('ontouchstart' in window || navigator.maxTouchPoints>0){
                setTimeout(positionToolbar, 0);
            }
        });
        document.addEventListener('click', (e)=>{
            if(!e.target.closest('#mobile-selection-menu')){
                mobileToolbar.classList.add('hidden');
            }
        });

        /* ---------------- Drag and Drop for Matching Questions ---------------- */

        (function initDragAndDrop() {
            const container = document.querySelector('.left-panel');
            if (!container) return;

            container.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('drag-item')) {
                    draggedElement = e.target;
                    setTimeout(() => {
                        e.target.classList.add('dragging');
                    }, 0);
                }
            });

            container.addEventListener('dragend', (e) => {
                if (draggedElement) {
                    draggedElement.classList.remove('dragging');
                    draggedElement = null;
                }
            });

            container.addEventListener('dragover', (e) => {
                e.preventDefault();
                const target = e.target;
                const dropZone = target.closest('.drop-zone');
                const optionsList = target.closest('.matching-options-list');

                if (dropZone || optionsList) {
                    const overElement = dropZone || optionsList;
                    document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
                    overElement.classList.add('drag-over');
                }
            });

            container.addEventListener('dragleave', (e) => {
                const target = e.target;
                const dropZone = target.closest('.drop-zone');
                const optionsList = target.closest('.matching-options-list');
                if (dropZone || optionsList) {
                    const overElement = dropZone || optionsList;
                    overElement.classList.remove('drag-over');
                }
            });


            container.addEventListener('drop', (e) => {
                e.preventDefault();
                if (!draggedElement) return;

                const dropTarget = e.target.closest('.drop-zone, .matching-options-list');
                if (!dropTarget) {
                    draggedElement.classList.remove('dragging');
                    draggedElement = null;
                    return;
                }

                // Skip if this is a Part 2 drop zone (let the Part 2 specific handler handle it)
                if (dropTarget.closest('#part-2')) {
                    draggedElement.classList.remove('dragging');
                    draggedElement = null;
                    return;
                }

                document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
                
                const existingItem = dropTarget.matches('.drop-zone') ? dropTarget.querySelector('.drag-item') : null;
                const originalParent = draggedElement.parentNode;

                // If there's an item in the target dropzone, swap them
                if (existingItem) {
                    // when moving existing item back, restore its full label
                    if (existingItem.dataset && existingItem.dataset.fullLabel) {
                        existingItem.textContent = existingItem.dataset.fullLabel;
                    }
                    
                    // If the original parent is a drop-zone, we need to handle it properly
                    if (originalParent.classList && originalParent.classList.contains('drop-zone')) {
                        // Clear the original drop zone first
                        originalParent.innerHTML = '';
                        originalParent.classList.remove('filled');
                        
                        // Restore placeholder
                        const placeholder = document.createElement('span');
                        placeholder.className = 'placeholder';
                        placeholder.innerHTML = '&nbsp;';
                        originalParent.appendChild(placeholder);
                        
                        // Clear the hidden input
                        const qId = originalParent.getAttribute('data-question-id');
                        const hiddenInput = document.getElementById(`q${qId}`);
                        if (hiddenInput) hiddenInput.value = '';
                        
                        // Now place the existing item in the original drop zone
                        originalParent.appendChild(existingItem);
                        
                        // Update the original drop zone to show it's filled
                        originalParent.classList.add('filled');
                        if (placeholder) placeholder.style.display = 'none';
                        
                        // Update the hidden input for the original drop zone
                        const existingItemValue = existingItem.getAttribute('data-value') || 
                                               existingItem.getAttribute('data-letter') || 
                                               (existingItem.dataset.fullLabel ? existingItem.dataset.fullLabel.trim().charAt(0).toUpperCase() : '');
                        if (hiddenInput) hiddenInput.value = existingItemValue;
                    } else {
                        // If original parent is not a drop zone, just append normally
                        originalParent.appendChild(existingItem);
                    }
                } else {
                    // If there's no existing item in the target drop zone, but the dragged item is coming from a drop zone,
                    // we need to restore the original drop zone to its empty state
                    if (originalParent.classList && originalParent.classList.contains('drop-zone')) {
                        // Clear the original drop zone
                        originalParent.innerHTML = '';
                        originalParent.classList.remove('filled');
                        
                        // Restore placeholder
                        const placeholder = document.createElement('span');
                        placeholder.className = 'placeholder';
                        placeholder.innerHTML = '&nbsp;';
                        originalParent.appendChild(placeholder);
                        
                        // Clear the hidden input
                        const qId = originalParent.getAttribute('data-question-id');
                        const hiddenInput = document.getElementById(`q${qId}`);
                        if (hiddenInput) hiddenInput.value = '';
                    }
                }
                
                dropTarget.appendChild(draggedElement);

                if(dropTarget.matches('.drop-zone')) {
                    const placeholder = dropTarget.querySelector('.placeholder');
                    if (placeholder) placeholder.style.display = 'none';
                    dropTarget.classList.add('filled');
                    // save full label once and show plain text only inside zone
                    if (!draggedElement.dataset.fullLabel) {
                        draggedElement.dataset.fullLabel = draggedElement.textContent.trim();
                    }
                    const full = draggedElement.dataset.fullLabel;
                    const letter = (full.match(/^\s*([A-G])\s*[\.)-]?/i) || [,''])[1].toUpperCase();
                    const plain = full.replace(/^\s*[A-G]\s*[\.)-]?\s*/i, '');
                    if (!draggedElement.dataset.letter && letter) {
                        draggedElement.dataset.letter = letter;
                    }
                    // Create a new element with the letter pill and plain text
                    const newElement = document.createElement('div');
                    newElement.className = 'drag-item';
                    newElement.setAttribute('draggable', 'true');
                    newElement.setAttribute('data-letter', letter);
                    newElement.setAttribute('data-value', letter);
                    newElement.setAttribute('data-fullLabel', full);
                    newElement.style.width = 'auto';
                    newElement.style.minWidth = 'fit-content';
                    
                    // Create the letter pill
                    const letterPill = document.createElement('span');
                    letterPill.className = 'drop-letter';
                    letterPill.textContent = letter;
                    
                    // Create the text span
                    const textSpan = document.createElement('span');
                    textSpan.textContent = plain;
                    textSpan.style.marginLeft = '8px';
                    textSpan.style.whiteSpace = 'nowrap';
                    
                    newElement.appendChild(letterPill);
                    newElement.appendChild(textSpan);
                    
                    // Replace the original element
                    draggedElement.parentNode.replaceChild(newElement, draggedElement);
                    draggedElement = newElement;
                    // sync hidden input (use data-letter if present, else text)
                    const qId = dropTarget.getAttribute('data-question-id');
                    const hiddenInput = document.getElementById(`q${qId}`);
                    if (hiddenInput) {
                        const val = draggedElement.getAttribute('data-letter') || letter || (draggedElement.dataset.fullLabel ? draggedElement.dataset.fullLabel.trim().charAt(0).toUpperCase() : draggedElement.textContent.trim());
                        hiddenInput.value = val;
                    }
                }

                draggedElement.classList.remove('dragging');
                draggedElement = null;
                updateAnsweredIndicators();
            });
        })();


        document.addEventListener('DOMContentLoaded', () => {
            switchToPart(1);
            goToQuestion(1);
            setupCheckboxLimits();
            
            // Initialize drag and drop and clickable cells
            initAllDragAndDrop();
            ensureClickableHiddenInputs();
            
            // Test clickable cells after a short delay
            setTimeout(() => {
                testClickableCells();
            }, 1000);

            document.body.addEventListener('contextmenu', function (e) {
                const text = window.getSelection().toString();
                if (!text) return;
                e.preventDefault();
                const menu = document.getElementById('contextMenu');
                menu.style.left = e.pageX + 'px';
                menu.style.top = e.pageY + 'px';
                menu.style.display = 'block';

                const target = e.target;
                const clearItem = document.getElementById('clear-item');
                contextElement = target.closest('.highlight, .comment-highlight');
                if(contextElement){
                    clearItem.style.display = 'block';
                } else {
                    clearItem.style.display = 'none';
                }
            });
            
            document.body.addEventListener('click', function(e) {
                if (e.target.closest('.context-menu')) return;
                document.getElementById('contextMenu').style.display = 'none';
            });
        });

        // Initial setup on DOM load
        document.addEventListener('DOMContentLoaded', function() {
            updateAnsweredIndicators();
            ensureClickableHiddenInputs();
            
            // Add specific event listeners for questions 17-25 radio buttons
            document.querySelectorAll('input[name="q17"], input[name="q18"], input[name="q19"], input[name="q20"], input[name="q21"], input[name="q22"], input[name="q23"], input[name="q24"], input[name="q25"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const questionNumber = this.name.substring(1); // Remove 'q' prefix
                    const hiddenInput = document.getElementById(`q${questionNumber}`);
                    if (hiddenInput) {
                        hiddenInput.value = this.value;
                        console.log(`Question ${questionNumber} selected: ${this.value}`);
                    }
                });
            });
        });

        document.querySelectorAll('.mcq-table td').forEach(cell => {
            cell.addEventListener('click', (e) => {
                if (e.target.tagName !== 'INPUT') {
                    const radio = cell.querySelector('input[type="radio"]');
                    if (radio && !radio.disabled) {
                        radio.checked = true;
                    }
                }
            });
        });

        document.querySelectorAll('.answer-input, input[type="radio"], input[type="checkbox"], select').forEach(input => {
            input.addEventListener('input', updateAnsweredIndicators);
            input.addEventListener('change', updateAnsweredIndicators);
        });

        function initAllDragAndDrop() {
            // Initialize clickable cells for questions 27-31
            initClickableCells();
            
            // Add event listeners for map questions (15-20)
            for (let i = 15; i <= 20; i++) {
                const selectElement = document.getElementById(`q${i}`);
                if (selectElement) {
                    selectElement.addEventListener('change', updateAnsweredIndicators);
                }
            }
        }

        function initClickableCells() {
            const clickableCells = document.querySelectorAll('.clickable-cell');
            clickableCells.forEach(cell => {
                cell.addEventListener('click', function() {
                    const questionNumber = this.getAttribute('data-question');
                    const value = this.getAttribute('data-value');
                    selectCell(this, questionNumber, value);
                });
            });
        }

        function selectCell(clickedCell, questionNumber, value) {
            // Remove previous selection for this question
            const questionRow = clickedCell.closest('tr');
            const cellsInRow = questionRow.querySelectorAll('.clickable-cell');
            cellsInRow.forEach(cell => {
                cell.classList.remove('selected');
                cell.style.backgroundColor = '';
            });
            
            // Select the clicked cell
            clickedCell.classList.add('selected');
            clickedCell.style.backgroundColor = '#4a90e2';
            clickedCell.style.color = 'white';
            // Persist selection in hidden input (for answered state and grading if needed)
            const hiddenInput = document.getElementById(`q${questionNumber}`);
            if (hiddenInput) {
                hiddenInput.value = value;
            }
            
            // Update answered indicators
            updateAnsweredIndicators();
        }

        function ensureClickableHiddenInputs() {
            for (let q = 27; q <= 30; q++) {
                if (!document.getElementById(`q${q}`)) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.id = `q${q}`;
                    document.body.appendChild(input);
                }
            }
        }

        function findParentOptionsList(element) {
            // Specific for map
            if (element.closest('#map-drag-container')) {
                return document.getElementById('map-options-q11-15');
            }
            // Specific for Part 3
            if (element.closest('#part-3')) {
                return document.getElementById('part3-options-box');
            }
            // Generic for matching
            const container = element.closest('.matching-container');
            if (container) {
                return container.querySelector('.matching-options-list');
            }
            return null;
        }

        let transcriptionHighlighted = false;
        function highlightAnswersInTranscription() {
            if (transcriptionHighlighted) return;

            const highlightedTranscripts = { 1: '', 2: '', 3: '', 4: '' };

            for (let i = 1; i <= 4; i++) {
                const partElement = document.querySelector(`#transcription-data [data-part="${i}"]`);
                if (partElement) highlightedTranscripts[i] = partElement.innerHTML;
            }

            for (const key in correctAnswers) {
                const answers = Array.isArray(correctAnswers[key]) ? correctAnswers[key] : [correctAnswers[key]];
                if (answers.every(answer => /^[A-G]$/.test(answer))) {
                    continue;
                }

                const qNum = parseInt(key.match(/\d+/)[0]);
                let partNumber = 1;
                if (qNum > 10 && qNum <= 20) partNumber = 2;
                else if (qNum > 20 && qNum <= 30) partNumber = 3;
                else if (qNum > 30) partNumber = 4;

                if (!highlightedTranscripts[partNumber]) continue;

                let answersToHighlight = correctAnswers[key];
                if (!Array.isArray(answersToHighlight)) {
                    answersToHighlight = [answersToHighlight];
                }

                for (const answer of answersToHighlight) {
                    if (/^[A-G]$/.test(answer)) continue;
                    
                    let searchTerm = answer.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
                    searchTerm = searchTerm.replace(/\\\(s\\\)/g, '(s)?');
                    
                    const regex = new RegExp(`\\b(${searchTerm})\\b`, 'gi');
                    
                    highlightedTranscripts[partNumber] = highlightedTranscripts[partNumber].replace(
                        regex,
                        '<span class="highlight">$1</span>'
                    );
                }
            }

            for (let i = 1; i <= 4; i++) {
                const partElement = document.querySelector(`#transcription-data [data-part="${i}"]`);
                if(partElement) partElement.innerHTML = highlightedTranscripts[i];
            }
            transcriptionHighlighted = true;
        }
        
        function closeContextMenu() {
            document.getElementById('contextMenu').style.display = 'none';
            contextElement = null;
        }
    </script>
</body>
</html>
